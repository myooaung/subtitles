WEBVTT

00:02.220 --> 00:04.070
So did you succeed.

00:04.080 --> 00:07.050
Let's implement this step by step together now.

00:07.320 --> 00:10.600
We'll have to work in the bookings service for that.

00:10.620 --> 00:15.240
There we have our ad booking and we have our canceled booking methods.

00:15.250 --> 00:17.720
Let's start with adding a booking.

00:17.750 --> 00:24.300
Now I will inject the angular h to be client here and I'll store it in a property named H to the P and

00:24.300 --> 00:34.480
the H if your client is imported from not just imported added for me here but from at angular slash

00:34.480 --> 00:36.520
common slash h t DP.

00:36.520 --> 00:43.000
So from this path here we import the age to be client and now they're we're creating this new booking

00:43.000 --> 00:44.090
which is okay.

00:44.320 --> 00:47.830
And then I will do the same thing I did in the places service.

00:47.830 --> 00:54.880
I'll use the H to the p client to send a post request and we can use to your l from the place service

00:54.910 --> 01:03.980
as a starting point not SD full year L but as a starting point here when we're adding a single place

01:04.820 --> 01:09.020
I will copy it and then go into my booking service and use it there.

01:09.020 --> 01:14.750
But of course I don't want to store my bookings under the offered places note but instead under bookings

01:14.840 --> 01:17.430
booking star Jason.

01:17.600 --> 01:22.640
Now the second argument here is the data we do want to store and that of course is my new booking.

01:22.640 --> 01:25.840
But without the I.D. I auto generated here.

01:25.850 --> 01:32.420
Instead I want to use the I.D. firebase gives me so just as with the place I will copy my new booking

01:32.720 --> 01:40.240
and overwrite the idea with a null value so that firebase will not store it this sends the post request

01:40.270 --> 01:45.500
to add a booking we can now add the pipe method and there is a tab.

01:45.510 --> 01:52.590
Operator And here I want to add this to my list of bookings I already have.

01:53.510 --> 01:59.810
So first of all we need to get all these bookings which we can do with switch map operator as you learned

02:00.110 --> 02:12.240
switch map imported from our as operators and switch map allows us to get our response data here which

02:12.240 --> 02:15.100
includes that generate ideas which I want to store.

02:15.180 --> 02:22.810
So I'll add my generated I.D. property up there which will be a string then in here I will set generated

02:22.820 --> 02:28.680
IDR equal to rest data thought name because we know and that is also something we can add here with

02:28.680 --> 02:34.980
the angle brackets after post that the data we get back here will have the same structure it has for

02:34.980 --> 02:40.830
adding a place so an object with a name field which holds a string which is that I.D. generated by firebase.

02:41.670 --> 02:47.340
So now I'm storing that idea and generate that I.D. other than that and switch map here I'm returning

02:47.340 --> 02:57.750
this bookings so my list of bookings and now by the way just as in places of course we could have loaded

02:58.260 --> 03:05.640
our app on the app place or on the book and event place and then we would fetch our list of bookings

03:05.640 --> 03:09.770
here which initially is empty and the same for the places initially that is empty.

03:12.100 --> 03:18.310
Now we would then add our newly added place or booking to an empty list of places or off bookings.

03:18.310 --> 03:24.910
But this is not a huge issue because whenever we go back to the bookings or the places page we do call

03:24.910 --> 03:30.670
fetch places or later all the fetch bookings here and therefore we will get the latest snapshot from

03:30.670 --> 03:35.770
the server there anyways so doesn't matter here and we won't get an error because whilst we add it to

03:35.770 --> 03:37.660
an empty list it still is a list.

03:37.750 --> 03:39.510
So that should all work.

03:39.610 --> 03:46.140
So we can now just go to tap where we get our bookings and then in here we can use the same logic we

03:46.150 --> 03:51.940
used before to concatenate our new booking here to dead list of bookings.

03:51.940 --> 03:58.240
So let me remove all of that new booking is available here because we created it outside of our observable

03:58.240 --> 03:58.680
chain.

03:58.720 --> 04:06.330
So outside of a function in our observable chain and with that we actually have almost everything we

04:06.330 --> 04:06.980
need.

04:06.990 --> 04:12.990
One thing I need to do though is on the new booking I'll override the I.D. with my generated I.D. which

04:12.990 --> 04:21.140
I do fetch here of course and now with dad where Dana we can hopefully add a booking that also is stored

04:21.200 --> 04:22.640
on the server.

04:22.640 --> 04:27.070
So let's give this a try and let's wait for it his application to reload.

04:27.140 --> 04:32.720
Let's visit this and we can't book this because we're on the wrong user to fix Dad let's quickly go

04:32.720 --> 04:40.430
to these off servers and let's change our user I.D. again ABC so that we're not the user who created

04:40.430 --> 04:41.150
this.

04:41.220 --> 04:52.260
And now if this reloads click book here a random date and enter your data here click book and I'm getting

04:52.260 --> 04:55.990
an error cannery property subscribe of undefined.

04:56.250 --> 05:02.260
Yes because in the bookings service I probably forgot to return as observable change.

05:02.280 --> 05:03.750
Yes I did.

05:03.810 --> 05:09.110
So make sure to add return in front of this new observable chain and then save that and let's try again

05:11.080 --> 05:13.180
so we're starting here.

05:13.430 --> 05:18.690
Random date enter your data and click book.

05:18.690 --> 05:24.750
Now there is no error and it's a booking but this takes very long.

05:24.750 --> 05:30.390
Let's have a look at Firebase and there we actually see bookings and that is the booking I just made.

05:30.540 --> 05:36.210
So this is basically doing the booking I just started.

05:36.210 --> 05:37.680
So it almost works.

05:37.680 --> 05:40.620
But this spinner never disappears.

05:40.620 --> 05:43.150
So we're not entirely there.

05:43.230 --> 05:45.240
Let's have a look at our place.

05:45.240 --> 05:55.510
Detail page which is where we do in the end call this method here and on book plays in the end we call

05:55.570 --> 06:00.760
add booking here and we subscribe and we do dismiss the loading element here.

06:00.980 --> 06:07.100
And the reason for that is that I introduced it back here when I fetched my current bookings does bookings

06:07.100 --> 06:08.280
list.

06:08.510 --> 06:15.440
Of course I only want to take one here that is important otherwise just as we did it before.

06:15.440 --> 06:20.290
Otherwise I set up an ongoing subscription which I don't want here.

06:20.330 --> 06:31.840
So ad take one year after it is switch map and now let's wait for it to reload and let's test this here

06:33.940 --> 06:36.250
and now this disappears as it should.

06:36.250 --> 06:40.030
Now of course we also now see the bookings here on the bookings page.

06:40.090 --> 06:42.880
However not if we reload the app on this page.

06:42.880 --> 06:44.530
So this is something we should also tackle.
