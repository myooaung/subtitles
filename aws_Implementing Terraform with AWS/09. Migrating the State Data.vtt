WEBVTT
1
00:00:01.040 --> 00:00:03.510
[Autogenerated] All right, we are back in ves code.

2
00:00:03.510 --> 00:00:06.880
And since we're gonna be working with our Dev vpc,

3
00:00:06.880 --> 00:00:12.580
we're gonna go ahead and expand the one dash Dev Dash VPC folder and you'll

4
00:00:12.580 --> 00:00:17.510
note one of the files in there is back end dot t f dot rename.

5
00:00:17.510 --> 00:00:21.750
That's where RBAC end configuration is before we open that,

6
00:00:21.750 --> 00:00:26.400
let's open up commands dot txt and you'll see at the bottom of this file.

7
00:00:26.400 --> 00:00:29.510
I have a state migration module component.

8
00:00:29.510 --> 00:00:34.290
These are the commands to follow When you migrate your back end.

9
00:00:34.290 --> 00:00:37.520
The first thing to do is rename that back end dot t f

10
00:00:37.520 --> 00:00:40.020
dot rename to back end dot t f.

11
00:00:40.020 --> 00:00:41.720
Once it's a dot t f file.

12
00:00:41.720 --> 00:00:44.820
Terra form will consider it part of the configuration.

13
00:00:44.820 --> 00:00:48.140
So let's go ahead and highlight that.

14
00:00:48.140 --> 00:00:51.450
Copy it and we'll bring up the terminal and make

15
00:00:51.450 --> 00:00:53.740
sure I'm in the right directory.

16
00:00:53.740 --> 00:00:55.740
How many times am I going to do that?

17
00:00:55.740 --> 00:00:58.110
And go ahead and rename that file?

18
00:00:58.110 --> 00:00:59.350
There we go now, we can.

19
00:00:59.350 --> 00:01:03.320
Take a look at what's in that back end configuration and whoa,

20
00:01:03.320 --> 00:01:04.950
there's not much here.

21
00:01:04.950 --> 00:01:06.840
We've got our ______ form block.

22
00:01:06.840 --> 00:01:10.320
We've got our back end and setting it to S3 is the type.

23
00:01:10.320 --> 00:01:13.340
And then all we're doing is defining the key.

24
00:01:13.340 --> 00:01:17.180
What is the object path where we want to write our

25
00:01:17.180 --> 00:01:19.450
state data within that S3 bucket,

26
00:01:19.450 --> 00:01:22.590
we're gonna write it to networking slash dev dash V P C

27
00:01:22.590 --> 00:01:25.540
slash terra form dot T f state Sounds good.

28
00:01:25.540 --> 00:01:29.300
By having a well defined path that means we can reuse this

29
00:01:29.300 --> 00:01:33.510
bucket for other state data for other configurations that

30
00:01:33.510 --> 00:01:35.840
we might be deploying later.

31
00:01:35.840 --> 00:01:38.180
You'll also note that I left out a lot of information here,

32
00:01:38.180 --> 00:01:41.350
and that's because we're going to supply that in line as part

33
00:01:41.350 --> 00:01:44.280
of the terra form initialization process.

34
00:01:44.280 --> 00:01:48.980
Let's go back to the commands dot txt area and you can see

35
00:01:48.980 --> 00:01:52.010
there's a ______ form in it commands here that needs some

36
00:01:52.010 --> 00:01:53.550
information to be filled out.

37
00:01:53.550 --> 00:01:55.760
The first thing is that S3 bucket.

38
00:01:55.760 --> 00:01:57.610
So I'm gonna go ahead and copy that out of my

39
00:01:57.610 --> 00:02:00.820
Notepad document and pasted in here.

40
00:02:00.820 --> 00:02:02.750
All right, we've got that set.

41
00:02:02.750 --> 00:02:10.290
Now we need the AWS region and we know that that is East us one.

42
00:02:10.290 --> 00:02:10.900
All right.

43
00:02:10.900 --> 00:02:11.410
Awesome.

44
00:02:11.410 --> 00:02:14.470
And then the last thing we need is our dynamo db table

45
00:02:14.470 --> 00:02:19.500
name I'll go ahead and copy that out of my Notepad and

46
00:02:19.500 --> 00:02:22.790
paste it in here and all right, that is thief full,

47
00:02:22.790 --> 00:02:23.160
innit?

48
00:02:23.160 --> 00:02:28.940
Command to use the S3 bucket, the dynamodb table and the correct region.

49
00:02:28.940 --> 00:02:32.190
You might be wondering about authentication in all this because I

50
00:02:32.190 --> 00:02:35.040
didn't specify that in the back end config.

51
00:02:35.040 --> 00:02:36.330
If you remember earlier,

52
00:02:36.330 --> 00:02:40.890
we set our AWS underscore profile environment variable to infra,

53
00:02:40.890 --> 00:02:45.400
which means it's going to use the infra account for the authentication.

54
00:02:45.400 --> 00:02:49.840
So let's go ahead and copy this and paste it down here

55
00:02:49.840 --> 00:02:54.340
and we'll go ahead and run the command.

56
00:02:54.340 --> 00:02:59.040
And if I put in the correct region, I bet you picked up on that.

57
00:02:59.040 --> 00:03:00.940
Let's say it's us East.

58
00:03:00.940 --> 00:03:02.940
One apps.

59
00:03:02.940 --> 00:03:04.120
There we go.

60
00:03:04.120 --> 00:03:06.340
See, we all make mistakes, right?

61
00:03:06.340 --> 00:03:08.990
And go ahead and paste that one in and run it.

62
00:03:08.990 --> 00:03:09.670
Here we go.

63
00:03:09.670 --> 00:03:10.110
All right.

64
00:03:10.110 --> 00:03:12.370
It's initializing the back end and we can.

65
00:03:12.370 --> 00:03:15.780
See, now it's saying, Hey, I see you have existing state.

66
00:03:15.780 --> 00:03:18.420
Do you want to copy it to the new back end?

67
00:03:18.420 --> 00:03:19.370
Absolutely.

68
00:03:19.370 --> 00:03:20.060
Yes, I do.

69
00:03:20.060 --> 00:03:21.570
So I'm gonna put in Hawaii.

70
00:03:21.570 --> 00:03:26.630
Yes, to copy this and there we go.

71
00:03:26.630 --> 00:03:29.530
It has successfully initialized if we scroll up a little bit

72
00:03:29.530 --> 00:03:32.760
we can see successfully configured the back end S3.

73
00:03:32.760 --> 00:03:38.230
So it has moved the state data from our local file up to S3.

74
00:03:38.230 --> 00:03:42.450
If we go over to the AWS console, Okay,

75
00:03:42.450 --> 00:03:45.590
here we are in the AWS console looking at S3.

76
00:03:45.590 --> 00:03:46.690
And there's our globe.

77
00:03:46.690 --> 00:03:49.020
012251 bucket.

78
00:03:49.020 --> 00:03:52.830
Let's go ahead and open that in there.

79
00:03:52.830 --> 00:03:58.250
We've got our networking folder and in that we should have our VPC folder And

80
00:03:58.250 --> 00:04:02.260
there's our ______ form .NET TF state we can Click on open,

81
00:04:02.260 --> 00:04:06.310
and it will open up that file and it correctly interprets it as JSON.

82
00:04:06.310 --> 00:04:10.130
So here's all of our state data that we just moved from

83
00:04:10.130 --> 00:04:13.350
our local back end to this S3 back end.

84
00:04:13.350 --> 00:04:15.440
Our job here is complete.

85
00:04:15.440 --> 00:04:16.580
Now, in a previous module,

86
00:04:16.580 --> 00:04:21.150
we also created to production VP CS one in US East one

87
00:04:21.150 --> 00:04:22.940
and the other one in US West one.

88
00:04:22.940 --> 00:04:32.000
I leave it as an exercise to you to also migrate those to use this same bucket as their back end

