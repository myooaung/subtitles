WEBVTT
1
00:00:00.940 --> 00:00:03.340
[Autogenerated] we've already got the infrastructure set up for

2
00:00:03.340 --> 00:00:06.920
our application and there's not really much that CloudFormation

3
00:00:06.920 --> 00:00:09.640
can add to those existing resources.

4
00:00:09.640 --> 00:00:13.740
So instead I thought we'd basically recreate the existing

5
00:00:13.740 --> 00:00:18.550
infrastructure with cloudformation view the app working 100% and

6
00:00:18.550 --> 00:00:22.480
then delete the stack I've created and included a CloudFormation

7
00:00:22.480 --> 00:00:25.240
template in the class exercise files.

8
00:00:25.240 --> 00:00:28.420
This template is based on the Pizza Lovers infrastructure

9
00:00:28.420 --> 00:00:30.940
we've created so far in this course,

10
00:00:30.940 --> 00:00:33.440
let's take a look at it before we use it to create a

11
00:00:33.440 --> 00:00:38.300
stack in the CloudFormation folder, opened the Pizza dot template file.

12
00:00:38.300 --> 00:00:43.770
Now this YAML document is over 500 lines long so there is

13
00:00:43.770 --> 00:00:46.300
no way I can go over the whole thing.

14
00:00:46.300 --> 00:00:51.520
I thought I'd just call out some highlights so you can better understand how

15
00:00:51.520 --> 00:00:56.710
these templates work inside the resources section are properties that

16
00:00:56.710 --> 00:01:00.440
represent different resources that will be provisioned.

17
00:01:00.440 --> 00:01:03.760
Each resource has a type that will tell you what it is,

18
00:01:03.760 --> 00:01:08.290
like how this is the VPc to create the property section

19
00:01:08.290 --> 00:01:12.380
defines resource specific properties that will be configured

20
00:01:12.380 --> 00:01:15.560
for the resource in this VPc resource,

21
00:01:15.560 --> 00:01:20.590
you can see it setting the cider block and even giving it the name.

22
00:01:20.590 --> 00:01:25.010
Pizza Vpc CloudFormation if we want to change any of these properties,

23
00:01:25.010 --> 00:01:27.840
we just update the value for that property.

24
00:01:27.840 --> 00:01:30.480
Now, if you scroll down to line 1 13,

25
00:01:30.480 --> 00:01:33.580
you can see that here's an auto scaling group that's being

26
00:01:33.580 --> 00:01:37.970
provisioned many of the properties for this resource are actually

27
00:01:37.970 --> 00:01:42.290
referencing other resource values in this document.

28
00:01:42.290 --> 00:01:46.040
Each property in this confirmation template is interesting

29
00:01:46.040 --> 00:01:48.340
but I just want to show you one last thing.

30
00:01:48.340 --> 00:01:50.250
If you go to the very end of the file,

31
00:01:50.250 --> 00:01:53.410
We're actually creating security group rules.

32
00:01:53.410 --> 00:01:59.530
These are individual resources for each ingress or egress rule with

33
00:01:59.530 --> 00:02:03.210
CloudFormation you can create almost anything in a W S that you want.

34
00:02:03.210 --> 00:02:04.740
Now let's create a stack.

35
00:02:04.740 --> 00:02:08.640
Go to the CloudFormation dashboard in the AWS management console,

36
00:02:08.640 --> 00:02:11.490
we'll go through the stack creation wizard.

37
00:02:11.490 --> 00:02:14.560
So click the create stack button here.

38
00:02:14.560 --> 00:02:17.800
You can choose whether to use a pre created template,

39
00:02:17.800 --> 00:02:22.140
a sample template or the designer to create your stack.

40
00:02:22.140 --> 00:02:23.700
We already have our template.

41
00:02:23.700 --> 00:02:27.580
So leave template is ready, selected next,

42
00:02:27.580 --> 00:02:34.040
select the uploaded template file and then click the choose file button.

43
00:02:34.040 --> 00:02:37.430
Look in the CloudFormation folder in the Pizza Lovers code

44
00:02:37.430 --> 00:02:40.840
and select the pizza dot template file.

45
00:02:40.840 --> 00:02:43.770
Now, click next let's name the stack.

46
00:02:43.770 --> 00:02:48.270
Pizza stack now in the parameter section you can see that

47
00:02:48.270 --> 00:02:51.740
there are some fields we need to fill.

48
00:02:51.740 --> 00:02:55.340
These are parameters that are defined in our template.

49
00:02:55.340 --> 00:03:00.320
We need an am I I D for our ec two instances and also

50
00:03:00.320 --> 00:03:02.700
the key pair to set them up with.

51
00:03:02.700 --> 00:03:06.010
You can see that the key pair is already filled in because

52
00:03:06.010 --> 00:03:08.780
I put a default value in the template.

53
00:03:08.780 --> 00:03:11.970
You can change it if you need to but likely if you've

54
00:03:11.970 --> 00:03:13.940
been following along this course.

55
00:03:13.940 --> 00:03:17.420
Pizza keys is perfect for the am I.

56
00:03:17.420 --> 00:03:20.140
We need to go fetch that open the ec.

57
00:03:20.140 --> 00:03:25.740
Two dashboard in a new tab, click the Emmys menu option on the left,

58
00:03:25.740 --> 00:03:32.540
select the Pizza Plus S3 image and then copy the AM I I D.

59
00:03:32.540 --> 00:03:35.290
Then back in the CloudFormation screen,

60
00:03:35.290 --> 00:03:39.940
enter the AmI ID into the image ID input field.

61
00:03:39.940 --> 00:03:43.330
Now you can click next in this screen are more

62
00:03:43.330 --> 00:03:45.610
optional configuration selections,

63
00:03:45.610 --> 00:03:50.440
we won't be using any of these so just scroll down and click next.

64
00:03:50.440 --> 00:03:55.090
Then we have a review screen scroll to the bottom and select the

65
00:03:55.090 --> 00:03:57.890
check box saying that you acknowledge I am.

66
00:03:57.890 --> 00:03:59.980
Resources will be created.

67
00:03:59.980 --> 00:04:03.910
This is necessary because the template is creating things like roles

68
00:04:03.910 --> 00:04:10.210
and policies in I am now click create stack Stacks.

69
00:04:10.210 --> 00:04:14.480
Do take some time to provision all the resources and I've found

70
00:04:14.480 --> 00:04:18.400
this pizza lovers stack can take as long as 15 minutes until the

71
00:04:18.400 --> 00:04:21.240
load balancer is responding to requests.

72
00:04:21.240 --> 00:04:25.740
In the meantime you can use this CloudFormation dashboard to view progress,

73
00:04:25.740 --> 00:04:30.540
select the stack we just created and select the events tab.

74
00:04:30.540 --> 00:04:33.940
This shows you any events that have occurred on the stack.

75
00:04:33.940 --> 00:04:38.360
You can see there are a lot of creatine progress and create complete

76
00:04:38.360 --> 00:04:42.040
events logged for various provisioned resources,

77
00:04:42.040 --> 00:04:46.770
You can refresh the list as well to see updated information on each event.

78
00:04:46.770 --> 00:04:50.470
I'm going to skip ahead the video here so we can test out our stack,

79
00:04:50.470 --> 00:04:54.250
you can see here that the stack is now showing create complete

80
00:04:54.250 --> 00:04:57.010
which means all resources have been created,

81
00:04:57.010 --> 00:05:01.760
our application does take a little extra time to finish booting up but I've

82
00:05:01.760 --> 00:05:06.950
waited about 15 minutes so it should be live now go to the ec two console

83
00:05:06.950 --> 00:05:10.140
and select load balancers in the left menu,

84
00:05:10.140 --> 00:05:13.790
find the load balancer that is not called Pizza loader,

85
00:05:13.790 --> 00:05:17.240
it should have a name that looks a little bit random,

86
00:05:17.240 --> 00:05:22.460
this is the load balancer created by CloudFormation click on the description tag

87
00:05:22.460 --> 00:05:28.640
and copy the DNS name Paces into a new tab and then hit go.

88
00:05:28.640 --> 00:05:34.720
Pizza Lovers should appear and everything should be fully functional now,

89
00:05:34.720 --> 00:05:38.810
CloudFormation was used to spend up all of this architecture but let's

90
00:05:38.810 --> 00:05:41.960
see how easy it makes it to get rid of it as well.

91
00:05:41.960 --> 00:05:44.330
Go back to the CloudFormation list,

92
00:05:44.330 --> 00:05:49.580
select Pizza stack and then click the delete button in the modal,

93
00:05:49.580 --> 00:05:53.940
confirm the deletion by clicking the delete stack button.

94
00:05:53.940 --> 00:05:58.130
CloudFormation will go through every resource that it created and deleted,

95
00:05:58.130 --> 00:06:02.320
leaving no trace that it ever existed with CloudFormation were able

96
00:06:02.320 --> 00:06:06.840
to easily recreate infrastructure to power our web applications

97
00:06:06.840 --> 00:06:08.860
with static CloudFormation templates.

98
00:06:08.860 --> 00:06:16.000
You can avoid human error and safely store and record changes to your infrastructure in version control

