WEBVTT
1
00:00:00.940 --> 00:00:03.350
[Autogenerated] our final step for working with S3

2
00:00:03.350 --> 00:00:06.100
is to redeploy our app to ec two.

3
00:00:06.100 --> 00:00:10.040
So everything that we've done so far is working together.

4
00:00:10.040 --> 00:00:11.550
We do have to revise something.

5
00:00:11.550 --> 00:00:12.440
However,

6
00:00:12.440 --> 00:00:15.990
when we are running our application locally and make requests to put

7
00:00:15.990 --> 00:00:21.430
objects in S3 it uses the access key credentials we created when the

8
00:00:21.430 --> 00:00:23.620
app is running on an ec two instance.

9
00:00:23.620 --> 00:00:26.840
However, what credentials does it use?

10
00:00:26.840 --> 00:00:28.810
The answer is none.

11
00:00:28.810 --> 00:00:33.330
When we were creating our Ec two instance and launch template,

12
00:00:33.330 --> 00:00:38.870
we didn't set it up to use any credentials in AWS I AM Rolls

13
00:00:38.870 --> 00:00:42.040
are used for EC two application credentials,

14
00:00:42.040 --> 00:00:46.210
we can assign an I am role at the launch template level.

15
00:00:46.210 --> 00:00:52.580
So our next steps are first to update the Pizza O G E Ec two instance

16
00:00:52.580 --> 00:00:58.500
with our new code and then create a new AM I with that updated instance

17
00:00:58.500 --> 00:01:03.290
and then finally create a new version of our launch template that will

18
00:01:03.290 --> 00:01:06.340
attach to our Pizza Auto scaling group.

19
00:01:06.340 --> 00:01:09.900
We'll start by copying our Pizza Lovers code to the Ec two

20
00:01:09.900 --> 00:01:14.580
instance Using SCP make sure to delete the node modules folder

21
00:01:14.580 --> 00:01:18.540
again and then execute this SCP command,

22
00:01:18.540 --> 00:01:24.060
inserting your own details to copy the Pizza Lovers code over the SCP command

23
00:01:24.060 --> 00:01:29.050
won't overwrite our node modules folder on the instance so we shouldn't need

24
00:01:29.050 --> 00:01:34.120
to run NPM install again now our code has been copied and everything is

25
00:01:34.120 --> 00:01:37.510
updated and ready to go in the two console,

26
00:01:37.510 --> 00:01:40.640
click on the instances, menu option on the left,

27
00:01:40.640 --> 00:01:43.440
select your Pizza Hoagie instance.

28
00:01:43.440 --> 00:01:50.150
Then in the actions, drop down click image and templates and select create image.

29
00:01:50.150 --> 00:01:53.080
Name it something like Pizza Plus,

30
00:01:53.080 --> 00:01:57.550
S3 and then click create While our AM is being created,

31
00:01:57.550 --> 00:02:01.840
we can go create the role that will use with our Ec two application,

32
00:02:01.840 --> 00:02:06.920
click on the Services menu above type I am and then

33
00:02:06.920 --> 00:02:12.040
hit enter in the I AM dashboard, click on roles on the left.

34
00:02:12.040 --> 00:02:16.200
Roles are sort of like users but they don't have any way to log in.

35
00:02:16.200 --> 00:02:19.000
It's just something to attach policies to.

36
00:02:19.000 --> 00:02:22.460
We're going to create a role for our Pizza application,

37
00:02:22.460 --> 00:02:24.680
click create role,

38
00:02:24.680 --> 00:02:29.820
then we'll choose the service that will be using the role which will be E C two.

39
00:02:29.820 --> 00:02:35.320
Now click next we only need to give the role access to S3 right now.

40
00:02:35.320 --> 00:02:44.340
So search for S3 and the input box, Then select Amazon S three full access,

41
00:02:44.340 --> 00:02:47.340
then hit next twice.

42
00:02:47.340 --> 00:02:48.740
Now we'll name the role.

43
00:02:48.740 --> 00:02:54.940
Pizza E C to roll and then click create role.

44
00:02:54.940 --> 00:02:58.370
And one of the great things about this role is that we can attach

45
00:02:58.370 --> 00:03:01.900
policies to the role but don't have to change which applications

46
00:03:01.900 --> 00:03:04.090
have the role now that it's created,

47
00:03:04.090 --> 00:03:08.800
we can use it whenever we need to by now are am I should be completed.

48
00:03:08.800 --> 00:03:11.940
So come back to the Ec two console.

49
00:03:11.940 --> 00:03:16.010
We need to create a new version of our launch template to create

50
00:03:16.010 --> 00:03:22.340
instances with the new AM I and I am role that we created,

51
00:03:22.340 --> 00:03:26.700
click Launch templates in the left menu and then click on the I.

52
00:03:26.700 --> 00:03:27.080
D.

53
00:03:27.080 --> 00:03:30.290
For our launch template, click the actions,

54
00:03:30.290 --> 00:03:34.440
drop down and select modify template.

55
00:03:34.440 --> 00:03:39.420
The first thing we'll update is the Am I click the drop down where pizza

56
00:03:39.420 --> 00:03:47.380
images selected and type in Pizza dash plus and then select Pizza Plus S3

57
00:03:47.380 --> 00:03:53.640
when it appears now scroll to the bottom and expand the advanced details

58
00:03:53.640 --> 00:03:59.830
section in the I am instance profile, drop-down find the I am role.

59
00:03:59.830 --> 00:04:02.040
We just created Pizza E.

60
00:04:02.040 --> 00:04:02.300
C.

61
00:04:02.300 --> 00:04:07.160
To roll the great thing about launch templates is that all

62
00:04:07.160 --> 00:04:10.340
the configuration options that we selected before are

63
00:04:10.340 --> 00:04:12.820
carried over into this new version.

64
00:04:12.820 --> 00:04:17.140
So just click create template version.

65
00:04:17.140 --> 00:04:23.310
Now we can utilize the power of launch templates to easily update our instances.

66
00:04:23.310 --> 00:04:26.660
I didn't mention this when we were setting up our auto scaling group

67
00:04:26.660 --> 00:04:29.870
but whenever you select a launch template to use,

68
00:04:29.870 --> 00:04:34.160
you also specify the version of the launch template to use,

69
00:04:34.160 --> 00:04:37.610
you can select a specific version or you can just

70
00:04:37.610 --> 00:04:41.450
use the default or latest tags.

71
00:04:41.450 --> 00:04:45.740
The latest tag will always point to the version created most recently.

72
00:04:45.740 --> 00:04:48.940
The default tag is something you can set in your launch

73
00:04:48.940 --> 00:04:52.410
template When we created our auto scaling group,

74
00:04:52.410 --> 00:04:55.830
it selected the default tag by default.

75
00:04:55.830 --> 00:05:00.220
So if we update the default tag and our launch template to

76
00:05:00.220 --> 00:05:04.130
point to the new version that we just created that will update

77
00:05:04.130 --> 00:05:06.840
our auto scaling group automatically.

78
00:05:06.840 --> 00:05:08.220
So click the actions.

79
00:05:08.220 --> 00:05:12.740
Drop down again and select set default version In

80
00:05:12.740 --> 00:05:19.240
the drop down select version two, then click set as default version.

81
00:05:19.240 --> 00:05:23.060
Now if our auto scaling group creates new instances,

82
00:05:23.060 --> 00:05:26.540
it will use this new version of the launch template.

83
00:05:26.540 --> 00:05:29.040
So let's kick that off manually.

84
00:05:29.040 --> 00:05:33.750
Go to the instances dashboard via the left menu and select

85
00:05:33.750 --> 00:05:38.140
any instances that aren't called Pizza O G.

86
00:05:38.140 --> 00:05:42.340
These were the ones generated by our auto scaling group,

87
00:05:42.340 --> 00:05:48.140
click on the instance state, drop down and then select terminate instance.

88
00:05:48.140 --> 00:05:52.210
This will take some time to terminate the instances and launch the new ones.

89
00:05:52.210 --> 00:05:58.120
So again I'm going to time warp the video about 15 minutes in the future and if

90
00:05:58.120 --> 00:06:03.180
I take a look at the auto scaling group instances now I can see that to our in

91
00:06:03.180 --> 00:06:08.920
service and it shows that the launch template version used to bring them up is

92
00:06:08.920 --> 00:06:11.840
in fact the new one that we created.

93
00:06:11.840 --> 00:06:13.240
So let's try it out.

94
00:06:13.240 --> 00:06:14.980
Use the same load balancer,

95
00:06:14.980 --> 00:06:19.340
URL as before and our pizza lovers app should greet us,

96
00:06:19.340 --> 00:06:20.780
play around with it,

97
00:06:20.780 --> 00:06:30.000
make sure everything looks good and try to make a pizza to see that our role is working as intended and the integration with S3 is complete

