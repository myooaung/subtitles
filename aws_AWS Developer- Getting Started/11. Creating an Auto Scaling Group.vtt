WEBVTT
1
00:00:00.940 --> 00:00:02.750
[Autogenerated] with our load balancer created.

2
00:00:02.750 --> 00:00:07.650
We need to create an auto scaling group that can attach to it and supply it

3
00:00:07.650 --> 00:00:12.470
with instances to send traffic to in the EC two console.

4
00:00:12.470 --> 00:00:16.150
Look for the auto scaling groups menu option on the left,

5
00:00:16.150 --> 00:00:20.840
it's at the bottom so you'll probably have to scroll down to see it,

6
00:00:20.840 --> 00:00:23.920
click on it and then click on the create auto

7
00:00:23.920 --> 00:00:27.280
scaling group button using this flow.

8
00:00:27.280 --> 00:00:32.760
We can set up both our launch template and then the auto scaling

9
00:00:32.760 --> 00:00:37.980
group that will use that launch template to launch instances First

10
00:00:37.980 --> 00:00:42.590
we'll name the auto scaling group, name it Pizza dash A.

11
00:00:42.590 --> 00:00:42.850
S.

12
00:00:42.850 --> 00:00:44.040
G.

13
00:00:44.040 --> 00:00:46.340
Next is the launch template.

14
00:00:46.340 --> 00:00:49.910
Since we don't already have one click the create a

15
00:00:49.910 --> 00:00:55.270
launch template link in the new tab, let's name the launch template.

16
00:00:55.270 --> 00:00:56.820
Pizza dash L.

17
00:00:56.820 --> 00:00:58.040
T.

18
00:00:58.040 --> 00:01:02.610
Now scroll down to the am I section in the input field,

19
00:01:02.610 --> 00:01:07.560
type Pizza dash image and then select the pizza image

20
00:01:07.560 --> 00:01:10.750
am I that we created for instance,

21
00:01:10.750 --> 00:01:15.510
type select T two micro in the drop-down input.

22
00:01:15.510 --> 00:01:18.450
Although you won't want to do this for production,

23
00:01:18.450 --> 00:01:24.180
apps let's select a key pair here so that we can SSH into our instances.

24
00:01:24.180 --> 00:01:28.110
If we need to troubleshoot select pizza keys in the

25
00:01:28.110 --> 00:01:31.240
drop down in the network section,

26
00:01:31.240 --> 00:01:36.460
leave the VPc section selected and in the drop down box for

27
00:01:36.460 --> 00:01:40.430
security groups select Pizza E C two S.

28
00:01:40.430 --> 00:01:41.250
G.

29
00:01:41.250 --> 00:01:44.990
This is the security group that will be attached to any

30
00:01:44.990 --> 00:01:49.660
instances created with this launch template and since the rules

31
00:01:49.660 --> 00:01:52.140
are already set up on that security group.

32
00:01:52.140 --> 00:01:53.970
We can just use it here.

33
00:01:53.970 --> 00:01:59.740
Now scroll to the bottom and expand the advanced details section.

34
00:01:59.740 --> 00:02:02.140
There's one thing we need to do in here.

35
00:02:02.140 --> 00:02:05.520
It's not enough for our instances to just be created.

36
00:02:05.520 --> 00:02:10.340
We also need to automatically start our node application.

37
00:02:10.340 --> 00:02:14.670
This user data section is where we can run scripts to

38
00:02:14.670 --> 00:02:18.250
execute at instance startup here,

39
00:02:18.250 --> 00:02:22.410
we will paste in a shell script that changes directories to our

40
00:02:22.410 --> 00:02:28.160
application directory and then executes npm Start here's a script

41
00:02:28.160 --> 00:02:31.140
to enter into this user data field.

42
00:02:31.140 --> 00:02:36.520
The hash bang bin bash at the top of the script tells the launch

43
00:02:36.520 --> 00:02:41.070
configuration to execute the user data as a shell script.

44
00:02:41.070 --> 00:02:46.440
Once that's entered click create launch template.

45
00:02:46.440 --> 00:02:50.240
Now switch tabs back to the auto scaling group,

46
00:02:50.240 --> 00:02:53.270
click the refresh button next to the launch template.

47
00:02:53.270 --> 00:03:00.540
Drop down and then select the Pizza dash lt launch template we just created.

48
00:03:00.540 --> 00:03:03.930
Now click next in the network section,

49
00:03:03.930 --> 00:03:09.330
select our Pizza Vpc in the drop-down Then for sub nets,

50
00:03:09.330 --> 00:03:11.820
select both of our sub nets.

51
00:03:11.820 --> 00:03:14.780
The auto scaling group will launch instances in both.

52
00:03:14.780 --> 00:03:17.240
Now balancing them out,

53
00:03:17.240 --> 00:03:23.190
click next we do want a load balancer connected to this auto scaling group.

54
00:03:23.190 --> 00:03:27.740
So choose the attached to an existing load balancer box.

55
00:03:27.740 --> 00:03:29.610
Then in the target group.

56
00:03:29.610 --> 00:03:36.750
Drop down below that, select Pizza T G now click next for the group size.

57
00:03:36.750 --> 00:03:40.860
This is where you can define the maximum and minimum instances your

58
00:03:40.860 --> 00:03:45.370
auto scaling group will scale to the desired number is what you can

59
00:03:45.370 --> 00:03:50.120
set initially for how many instances the group will launch when we

60
00:03:50.120 --> 00:03:52.130
set scaling rules for the group.

61
00:03:52.130 --> 00:04:00.540
This desired number will change based on scaling, let's enter to two and four.

62
00:04:00.540 --> 00:04:03.760
Now we can set our scaling policy for this group.

63
00:04:03.760 --> 00:04:08.000
Target tracking policies make it really easy to configure auto scaling

64
00:04:08.000 --> 00:04:13.230
groups with you can set a target for a metric on your instances and then

65
00:04:13.230 --> 00:04:17.390
the auto scaling group will increase in decrease instances in the group

66
00:04:17.390 --> 00:04:20.300
to meet that number for our metric.

67
00:04:20.300 --> 00:04:24.470
Let's use average network out since that's a fairly

68
00:04:24.470 --> 00:04:27.540
accurate number two reference traffic.

69
00:04:27.540 --> 00:04:32.340
Then in target value let's enter 50,000 bytes.

70
00:04:32.340 --> 00:04:36.620
This number will need to be tweaked in your production apps until you find the

71
00:04:36.620 --> 00:04:40.000
sweet spot that keeps your instances where they should be.

72
00:04:40.000 --> 00:04:44.890
But since this is a demo happen, I've already figured this out for you.

73
00:04:44.890 --> 00:04:47.840
We can use this number here.

74
00:04:47.840 --> 00:04:54.540
Now click next and then next again and next for one last time.

75
00:04:54.540 --> 00:04:58.100
Now we're on the review screen and you can scroll down and

76
00:04:58.100 --> 00:05:01.840
click the create auto scaling group button.

77
00:05:01.840 --> 00:05:05.370
Now we should be back to the auto scaling group list.

78
00:05:05.370 --> 00:05:09.290
If you look in the list entry for the auto scaling group we just

79
00:05:09.290 --> 00:05:12.670
created you'll see some pretty good information.

80
00:05:12.670 --> 00:05:17.970
This section of numbers is where it tells us how many instances are launched in

81
00:05:17.970 --> 00:05:22.840
the auto scaling group and our men max and desired numbers.

82
00:05:22.840 --> 00:05:27.130
We should be at zero instances right now because we just launched

83
00:05:27.130 --> 00:05:30.970
the auto scaling group it will take some time to actually launch

84
00:05:30.970 --> 00:05:33.190
the instances skipping ahead in time.

85
00:05:33.190 --> 00:05:37.840
A few minutes we can see that the instances number has updated to two.

86
00:05:37.840 --> 00:05:42.460
If we click into the auto scaling group and then on the instance

87
00:05:42.460 --> 00:05:46.840
management tab we can see both of these instances.

88
00:05:46.840 --> 00:05:51.540
They are listed as in service with a health status of healthy.

89
00:05:51.540 --> 00:05:54.550
Let's check on the load balancer because it should be

90
00:05:54.550 --> 00:05:57.440
connected to these same instances,

91
00:05:57.440 --> 00:06:02.240
click on target groups and the left menu and then select Pizza T

92
00:06:02.240 --> 00:06:07.350
G from the list in the targets tab you can see that it lists

93
00:06:07.350 --> 00:06:11.760
those same two instances with a status of healthy as well as the

94
00:06:11.760 --> 00:06:13.840
Pizza Hoagie instance.

95
00:06:13.840 --> 00:06:18.030
The Pizza Hoagie instance may not be healthy because the app isn't

96
00:06:18.030 --> 00:06:21.340
running on that instance but that's totally fine.

97
00:06:21.340 --> 00:06:25.000
This healthy status means that we have everything configured

98
00:06:25.000 --> 00:06:28.630
correctly with our auto scaling group feeding the load

99
00:06:28.630 --> 00:06:31.940
balancers target group with instances,

100
00:06:31.940 --> 00:06:35.420
click the load balancers menu option on the left and then

101
00:06:35.420 --> 00:06:38.980
select Pizza loader on the description tab.

102
00:06:38.980 --> 00:06:41.770
You should see the DNS name field.

103
00:06:41.770 --> 00:06:47.390
This is the URL that you can use to access a load balancer in your browser.

104
00:06:47.390 --> 00:06:51.150
The idea is that then you would get a normal you are out like

105
00:06:51.150 --> 00:06:55.170
Pizza Lovers dot com and create a DNS C name,

106
00:06:55.170 --> 00:06:57.640
record 2.2 This load balancer.

107
00:06:57.640 --> 00:06:58.940
DNS name.

108
00:06:58.940 --> 00:07:02.800
We won't get into that in this course but we can copy this

109
00:07:02.800 --> 00:07:05.940
DNS record and try it out in our browser,

110
00:07:05.940 --> 00:07:10.420
copy and paste it into a new tab because the load balancer is

111
00:07:10.420 --> 00:07:14.120
listening on port 80 the default http port,

112
00:07:14.120 --> 00:07:18.300
you don't need to enter anything but the URL hit go and you should

113
00:07:18.300 --> 00:07:22.000
see Pizza Lovers open up and it's the demo app.

114
00:07:22.000 --> 00:07:26.490
It's running on the ec two instances that were created by an auto

115
00:07:26.490 --> 00:07:29.940
scaling group and then routed through a load balancer.

116
00:07:29.940 --> 00:07:31.340
Pretty cool.

117
00:07:31.340 --> 00:07:34.640
Now that our load balancer is sending traffic to our instances,

118
00:07:34.640 --> 00:07:39.040
we can adjust the security group rules to make them more secure,

119
00:07:39.040 --> 00:07:44.130
click on the security groups option in the left menu and then click on the I.

120
00:07:44.130 --> 00:07:44.600
D.

121
00:07:44.600 --> 00:07:49.820
For Pizza Ec two S G in the inbound rules tab.

122
00:07:49.820 --> 00:07:54.150
We have three rules listed here, One for ssh access,

123
00:07:54.150 --> 00:07:59.290
one for public access to port 3000 and one for port 3004.

124
00:07:59.290 --> 00:08:00.040
All I.

125
00:08:00.040 --> 00:08:00.320
P.

126
00:08:00.320 --> 00:08:02.110
V six addresses,

127
00:08:02.110 --> 00:08:06.820
we will still need to ssh into our instance as we modify the

128
00:08:06.820 --> 00:08:09.940
application to take advantage of other services.

129
00:08:09.940 --> 00:08:16.070
So we'll leave that SSH rule but we can change the 3000 rules to

130
00:08:16.070 --> 00:08:18.870
only accept connections from our load balancer,

131
00:08:18.870 --> 00:08:21.690
click the edit inbound rules button.

132
00:08:21.690 --> 00:08:22.300
A W.

133
00:08:22.300 --> 00:08:22.690
S.

134
00:08:22.690 --> 00:08:28.020
Currently doesn't allow you to change existing rules from an I.

135
00:08:28.020 --> 00:08:28.290
P.

136
00:08:28.290 --> 00:08:32.960
Source to a security group source which is what we want to do.

137
00:08:32.960 --> 00:08:39.640
So We'll start by deleting both of the security group rules for Port 3000.

138
00:08:39.640 --> 00:08:43.040
Then click the add rule button,

139
00:08:43.040 --> 00:08:52.340
Enter 3000 for the port and then in the source field type Pizza dash lb.

140
00:08:52.340 --> 00:08:53.950
This is going to bring up the auto,

141
00:08:53.950 --> 00:08:59.710
suggest drop-down with the load balancer security group to allow access from.

142
00:08:59.710 --> 00:09:04.620
So go ahead and select that this configuration means that any resource

143
00:09:04.620 --> 00:09:07.850
that has the load balancer security group attached to.

144
00:09:07.850 --> 00:09:13.740
It will be allowed to connect to our instances on port 3000.

145
00:09:13.740 --> 00:09:16.740
This is a way of conveniently giving access to a

146
00:09:16.740 --> 00:09:19.150
resource without being tied to an I.

147
00:09:19.150 --> 00:09:19.500
P.

148
00:09:19.500 --> 00:09:23.430
So our load balancer which has this Pizza L.

149
00:09:23.430 --> 00:09:24.280
B S.

150
00:09:24.280 --> 00:09:24.550
G.

151
00:09:24.550 --> 00:09:30.040
Security group attached to it will have access to our instances,

152
00:09:30.040 --> 00:09:32.140
click save rules.

153
00:09:32.140 --> 00:09:36.960
Now our instances are secure and ready to take real traffic from users.

154
00:09:36.960 --> 00:09:44.000
In the next clip we're going to see how our auto scaling group works when it's pushed to the limit

