1
00:00:01,130 --> 00:00:03,750
[Autogenerated] The solution to this problem is to connect the

2
00:00:03,750 --> 00:00:08,180
function to the data bases VPC in the toolkit window.

3
00:00:08,180 --> 00:00:12,150
It very clearly tells you that if your function accesses,

4
00:00:12,150 --> 00:00:16,600
resource is in a vpc that you need to make this connection,

5
00:00:16,600 --> 00:00:20,060
and it gives you a much more efficient way to achieve this.

6
00:00:20,060 --> 00:00:22,000
Then, if you were going through the console,

7
00:00:22,000 --> 00:00:25,520
you start by selecting one or more sub nets from the

8
00:00:25,520 --> 00:00:27,840
VPC that you want to connect to.

9
00:00:27,840 --> 00:00:32,480
And since this is just a demo and I don't care about high availability,

10
00:00:32,480 --> 00:00:34,340
I'll just choose one.

11
00:00:34,340 --> 00:00:37,780
It's important that the sub net is a public sub net,

12
00:00:37,780 --> 00:00:39,680
and all of these happen to be.

13
00:00:39,680 --> 00:00:45,140
That's the default When the VPC and its default sub nets get created.

14
00:00:45,140 --> 00:00:49,830
This map to public I p column doesn't mean that the sub net is public,

15
00:00:49,830 --> 00:00:51,910
though that's for something else.

16
00:00:51,910 --> 00:00:55,440
So don't rely on that for your selection,

17
00:00:55,440 --> 00:01:00,240
because I selected a sub net from the plural site RTs Vpc.

18
00:01:00,240 --> 00:01:02,780
The security group dropped down is now on Lee,

19
00:01:02,780 --> 00:01:06,630
showing me security groups from that same vpc.

20
00:01:06,630 --> 00:01:10,760
And here's where we need to remind you all the way back near the very

21
00:01:10,760 --> 00:01:16,760
beginning of this course when I asked the toolkit to create my RTs instance in

22
00:01:16,760 --> 00:01:22,940
a new custom VPC instead of creating in my default VPC.

23
00:01:22,940 --> 00:01:27,580
And because of that, I've had to do extra security steps throughout the course,

24
00:01:27,580 --> 00:01:31,010
and that's the case here to none of the security groups.

25
00:01:31,010 --> 00:01:31,990
In my custom,

26
00:01:31,990 --> 00:01:37,020
VPC have the correct inbound permissions that I need for my function.

27
00:01:37,020 --> 00:01:43,770
The default security group of the default VPC would be set up correctly and

28
00:01:43,770 --> 00:01:47,900
I'm going to use the default security group of this VPC.

29
00:01:47,900 --> 00:01:50,720
But I'll have to make some changes to it.

30
00:01:50,720 --> 00:01:53,130
And since this change takes a few minutes,

31
00:01:53,130 --> 00:01:57,410
I'll go ahead and apply the changes and we can take care of the security group.

32
00:01:57,410 --> 00:01:59,540
While this is processing,

33
00:01:59,540 --> 00:02:02,290
we can see the security groups right in the AWS

34
00:02:02,290 --> 00:02:05,090
Explorer start in the VPC section,

35
00:02:05,090 --> 00:02:09,220
then opened the security groups for the VP sees and here's the one

36
00:02:09,220 --> 00:02:14,640
I'm using the default security group for the plural site RTs vpc

37
00:02:14,640 --> 00:02:18,880
notice that it's on Lee Inbound rule is the one we added for the Far

38
00:02:18,880 --> 00:02:21,050
Gate Containers load balancer.

39
00:02:21,050 --> 00:02:26,640
I recognized the I D and you may recall, adding that in the previous module.

40
00:02:26,640 --> 00:02:30,710
Although you can add inbound rules right here in the tool kit,

41
00:02:30,710 --> 00:02:32,420
I want to add a special type.

42
00:02:32,420 --> 00:02:37,670
It's called a self referencing role, and I can't do that in the tool kit,

43
00:02:37,670 --> 00:02:42,140
so that means we have to go back to the console for that task.

44
00:02:42,140 --> 00:02:44,560
But I wanted to go back to the console anyway,

45
00:02:44,560 --> 00:02:48,850
so you could see what's going on with a function update from the services.

46
00:02:48,850 --> 00:02:50,090
Choose Lambda.

47
00:02:50,090 --> 00:02:53,750
You'll see a list of all the functions and then drill into our

48
00:02:53,750 --> 00:02:56,440
function on the top of the function page.

49
00:02:56,440 --> 00:03:01,550
There's a big blue bar telling us that that function is still being updated.

50
00:03:01,550 --> 00:03:05,140
Scroll down until you see the VPC section.

51
00:03:05,140 --> 00:03:07,950
Before I started doing this change,

52
00:03:07,950 --> 00:03:10,950
this section would have been mostly empty and it would

53
00:03:10,950 --> 00:03:13,640
have said there's no VPC connection.

54
00:03:13,640 --> 00:03:18,740
But now it shows the details about the choices I made the VPC,

55
00:03:18,740 --> 00:03:21,340
the Sub Net and Security group,

56
00:03:21,340 --> 00:03:25,250
and you can click on the hyperlink for the security group to get Teoh.

57
00:03:25,250 --> 00:03:26,760
Its details.

58
00:03:26,760 --> 00:03:28,250
We've done this before,

59
00:03:28,250 --> 00:03:31,670
will select the inbound rules for the security group and

60
00:03:31,670 --> 00:03:34,520
then click the Edit Inbound Rules Button.

61
00:03:34,520 --> 00:03:36,540
Then add rule.

62
00:03:36,540 --> 00:03:41,510
What we're going to do is add a self referencing rule which essentially

63
00:03:41,510 --> 00:03:46,520
says that any resource assigned to the security group can talkto any

64
00:03:46,520 --> 00:03:49,210
other resource assigned to the same group.

65
00:03:49,210 --> 00:03:54,050
To do this, select all traffic for the type and then enter the i.

66
00:03:54,050 --> 00:03:56,660
D of this same security group.

67
00:03:56,660 --> 00:04:00,580
So filtering on SG Dash 08 and there it iss.

68
00:04:00,580 --> 00:04:04,930
So choose that and then scroll down to save rules.

69
00:04:04,930 --> 00:04:08,660
And what's nice is the rules get applied right away.

70
00:04:08,660 --> 00:04:12,120
So that means when AWS is finished setting up that

71
00:04:12,120 --> 00:04:15,060
connection between the function and the VPC,

72
00:04:15,060 --> 00:04:19,190
everything with respect to that security group will be set up correctly.

73
00:04:19,190 --> 00:04:21,830
Okay, let's go check the status again in the console.

74
00:04:21,830 --> 00:04:25,940
And yes, the function has been successfully updated.

75
00:04:25,940 --> 00:04:31,330
There is still one more step to complete, but I want to drive that lesson home.

76
00:04:31,330 --> 00:04:33,740
Let's go back to the weather forecast controller of the

77
00:04:33,740 --> 00:04:36,270
function now that it's been updated now,

78
00:04:36,270 --> 00:04:40,810
the weather forecast isn't coming up and neither is the authors controller.

79
00:04:40,810 --> 00:04:47,000
The weather forecast was working before we connected the VPC controller. What happened here

