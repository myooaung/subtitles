WEBVTT
X-TIMESTAMP-MAP=LOCAL:00:00:00.000,MPEGTS:0

00:00:00.000 --> 00:00:01.460
hello.

00:00:01.460 --> 00:00:02.200
In this video,

00:00:02.200 --> 00:00:04.500
we will start creating charred bottom.

00:00:04.500 --> 00:00:06.250
Let's go before we begin.

00:00:06.250 --> 00:00:08.400
I want to mention that in the previous video,

00:00:08.400 --> 00:00:10.580
when we started to create chat Top,

00:00:10.580 --> 00:00:13.210
I forgot to mention a few details.

00:00:13.210 --> 00:00:14.000
First of all,

00:00:14.000 --> 00:00:18.850
we need to add a few more class names and it is going to be this age for Element.

00:00:18.850 --> 00:00:26.110
So let's put class name and we're gonna put text disappear to prevent tax from overflow if

00:00:26.110 --> 00:00:27.130
it is too long.

00:00:27.130 --> 00:00:33.890
And then we're gonna add the display flags and align Items Center to make sure that when we

00:00:33.890 --> 00:00:35.530
are on mobile devices,

00:00:35.530 --> 00:00:39.020
this Aiken and text are centered vertically,

00:00:39.020 --> 00:00:41.600
right and also one more detail.

00:00:41.600 --> 00:00:43.760
If we open the room in for Betty Inamoto,

00:00:43.760 --> 00:00:46.100
we used use context selector,

00:00:46.100 --> 00:00:47.790
So to make it work,

00:00:47.790 --> 00:00:50.550
we also need to rub the element around mammal.

00:00:50.550 --> 00:00:52.750
That's what we forgot to dio.

00:00:52.750 --> 00:00:58.500
So let's put memo here at the bottom and also let's imported from react Now use context.

00:00:58.500 --> 00:01:00.600
Selector will work as expected.

00:01:00.600 --> 00:01:01.410
All right,

00:01:01.410 --> 00:01:04.250
let's move on and let's start with Chad Bottom.

00:01:04.250 --> 00:01:09.070
Let's navigate Teoh Index Dodgy s inside the bottom folder.

00:01:09.070 --> 00:01:12.420
And here let's define our market so First of all,

00:01:12.420 --> 00:01:16.090
we're gonna pour in for group and inside this input group,

00:01:16.090 --> 00:01:19.650
we're gonna put the actual input with placeholder,

00:01:19.650 --> 00:01:21.090
right?

00:01:21.090 --> 00:01:25.310
And you message here and three dots at the end.

00:01:25.310 --> 00:01:26.700
Next to this import,

00:01:26.700 --> 00:01:29.100
we gonna pour a button element.

00:01:29.100 --> 00:01:34.120
So let's define import Group Dar button.

00:01:34.120 --> 00:01:41.870
And this button will have color blue and appearance Primary inside this barn group,

00:01:41.870 --> 00:01:42.900
we're gonna pour.

00:01:42.900 --> 00:01:46.860
I come and I can is going to be sent.

00:01:46.860 --> 00:01:47.550
All right,

00:01:47.550 --> 00:01:48.860
let's say wait and let's see,

00:01:48.860 --> 00:01:49.540
what do we have?

00:01:49.540 --> 00:01:52.260
So now we have this import and we have the bottom.

00:01:52.260 --> 00:01:53.560
So when we click on this button,

00:01:53.560 --> 00:01:55.080
the message will be sent.

00:01:55.080 --> 00:01:55.450
All right,

00:01:55.450 --> 00:01:55.730
now,

00:01:55.730 --> 00:01:57.800
let's define our functionality.

00:01:57.800 --> 00:01:59.010
So first of all,

00:01:59.010 --> 00:02:00.260
we need state.

00:02:00.260 --> 00:02:03.770
So let's create import and said in poor,

00:02:03.770 --> 00:02:07.670
and by default it will be set to an empty shrink.

00:02:07.670 --> 00:02:13.680
Then we need to specify on change handler for on change event for our import.

00:02:13.680 --> 00:02:18.250
And also we need to associate our input with the actual state.

00:02:18.250 --> 00:02:20.230
So let's define value.

00:02:20.230 --> 00:02:21.420
It is going to be importer.

00:02:21.420 --> 00:02:23.020
And for a change event,

00:02:23.020 --> 00:02:26.160
we're going to specify on import change.

00:02:26.160 --> 00:02:26.700
Heller.

00:02:26.700 --> 00:02:32.690
Let's define this on import change and we can optimize it in advance where they use

00:02:32.690 --> 00:02:39.090
callback because we have input state that changes frequently and on import change will not

00:02:39.090 --> 00:02:40.270
have any dependency.

00:02:40.270 --> 00:02:44.890
So this unchanged event gives us value as the first argument and event.

00:02:44.890 --> 00:02:47.670
So we need to get the actual value from here,

00:02:47.670 --> 00:02:49.350
and then we will call said,

00:02:49.350 --> 00:02:50.680
import with value.

00:02:50.680 --> 00:02:56.340
And just to mention that because we use this input that comes from our suit as a component

00:02:56.340 --> 00:02:56.340
,

00:02:56.340 --> 00:02:59.450
that's why we receive value as the first argument.

00:02:59.450 --> 00:03:00.930
In any other case,

00:03:00.930 --> 00:03:03.190
we will receive only the event object.

00:03:03.190 --> 00:03:07.950
Now we need to add functionality to our button to actually send the message.

00:03:07.950 --> 00:03:13.190
So that's why we're gonna specify a new function that we will name on Send Click.

00:03:13.190 --> 00:03:18.760
It is going to be our handler for on click Event on this button.

00:03:18.760 --> 00:03:19.920
So let's pacify.

00:03:19.920 --> 00:03:21.260
So foran click,

00:03:21.260 --> 00:03:24.910
we will pour on send click And first of all,

00:03:24.910 --> 00:03:28.630
here we will do a simple check If I were in port.

00:03:28.630 --> 00:03:35.700
If our message is not empty so we're gonna specify import dot trim equals empty message.

00:03:35.700 --> 00:03:36.950
If it is the case,

00:03:36.950 --> 00:03:39.650
then it will simply exit dysfunction.

00:03:39.650 --> 00:03:42.680
Next we need to assemble the message.

00:03:42.680 --> 00:03:46.550
And in the future we will also have filed messages.

00:03:46.550 --> 00:03:47.660
So for this,

00:03:47.660 --> 00:03:53.500
we gonna create a common function that will be called to assemble the message so it will

00:03:53.500 --> 00:03:56.730
attach common properties to our message.

00:03:56.730 --> 00:03:58.560
So here at the top,

00:03:58.560 --> 00:04:01.440
we're gonna create new function that we will name,

00:04:01.440 --> 00:04:02.650
assemble,

00:04:02.650 --> 00:04:03.730
message,

00:04:03.730 --> 00:04:08.360
and as an argument it will receive user profile.

00:04:08.360 --> 00:04:10.380
And let's say Chad,

00:04:10.380 --> 00:04:11.450
I d ok,

00:04:11.450 --> 00:04:18.370
and then it will give us an object with the room i d which is going to be checked,

00:04:18.370 --> 00:04:19.020
I d.

00:04:19.020 --> 00:04:25.660
Then we will have author object and here we will de normalized data before we continue.

00:04:25.660 --> 00:04:28.590
Let me explain the structure that we will have.

00:04:28.590 --> 00:04:31.350
So if we open our database right now,

00:04:31.350 --> 00:04:37.710
we have rooms and profiles and our data now is flat and really easy to manage.

00:04:37.710 --> 00:04:38.480
However,

00:04:38.480 --> 00:04:41.070
now we have rooms and we need to create messages.

00:04:41.070 --> 00:04:42.530
How can we approach this?

00:04:42.530 --> 00:04:45.970
We can obviously put messages inside this object,

00:04:45.970 --> 00:04:46.420
However,

00:04:46.420 --> 00:04:50.080
with real time data based because we are limited enquiries,

00:04:50.080 --> 00:04:53.700
we need to wisely decide on our structure.

00:04:53.700 --> 00:04:55.380
So with real time data base,

00:04:55.380 --> 00:04:59.770
it is really important to keep the structure as flat as possible.

00:04:59.770 --> 00:05:01.530
It means that ideally,

00:05:01.530 --> 00:05:04.890
we don't want to create nested object.

00:05:04.890 --> 00:05:08.440
So that's why we're gonna create another Let's see,

00:05:08.440 --> 00:05:12.160
route object that we will name messages and insight.

00:05:12.160 --> 00:05:17.900
We gonna put our message data and then to reference that this message belongs to this

00:05:17.900 --> 00:05:19.050
particular room.

00:05:19.050 --> 00:05:23.810
We're going to specify room I d inside this message.

00:05:23.810 --> 00:05:29.840
And also we will de Normalized Data de Normalizing means that we will copy and duplicate

00:05:29.840 --> 00:05:30.530
our data.

00:05:30.530 --> 00:05:37.630
This is to prevent performing multiple queries on our database when we need to display

00:05:37.630 --> 00:05:38.020
something.

00:05:38.020 --> 00:05:38.670
For example,

00:05:38.670 --> 00:05:40.370
chat message with chat message.

00:05:40.370 --> 00:05:43.960
We also want to display user profile name,

00:05:43.960 --> 00:05:45.710
Avatar and other things.

00:05:45.710 --> 00:05:47.770
So when we display message,

00:05:47.770 --> 00:05:49.080
if we don't duplicate data,

00:05:49.080 --> 00:05:53.900
we need to send a second request to our database and get the actual profile ometer.

00:05:53.900 --> 00:05:56.260
So to prevent performing multiple requests,

00:05:56.260 --> 00:05:57.340
we will duplicate it.

00:05:57.340 --> 00:06:00.200
So this is normal in no SQL databases.

00:06:00.200 --> 00:06:01.050
Let's go.

00:06:01.050 --> 00:06:04.410
So for assemble message for author,

00:06:04.410 --> 00:06:11.670
we gonna pour name which is going to be profiled the name then we gonna pour also your i d

00:06:11.670 --> 00:06:11.670
,

00:06:11.670 --> 00:06:19.050
which is going to be profile your i d then created at is going to be profile created at,

00:06:19.050 --> 00:06:22.080
and also we need to pour conditional avatar.

00:06:22.080 --> 00:06:24.230
So if you there don't have any arbiter,

00:06:24.230 --> 00:06:27.210
we do not put it inside this object for that.

00:06:27.210 --> 00:06:29.260
We're gonna pour three dots.

00:06:29.260 --> 00:06:32.430
Then we're gonna poor profile on Avatar,

00:06:32.430 --> 00:06:35.600
and we're gonna ask if gift exists.

00:06:35.600 --> 00:06:40.120
Then we're gonna pour avatar key with profile door avatar.

00:06:40.120 --> 00:06:41.380
So otherwise,

00:06:41.380 --> 00:06:43.480
we will pour an empty object.

00:06:43.480 --> 00:06:45.900
So when profile avatar exists,

00:06:45.900 --> 00:06:47.820
we're going to specify this object.

00:06:47.820 --> 00:06:49.660
And because off three dots,

00:06:49.660 --> 00:06:53.960
we cannot spread this object to this global object.

00:06:53.960 --> 00:06:54.730
So in this way,

00:06:54.730 --> 00:06:57.240
it will attach this property to this object.

00:06:57.240 --> 00:06:57.810
Otherwise,

00:06:57.810 --> 00:06:59.740
we will spread the empty object,

00:06:59.740 --> 00:07:01.510
which will add nothing.

00:07:01.510 --> 00:07:02.090
Okay,

00:07:02.090 --> 00:07:03.660
So next your author,

00:07:03.660 --> 00:07:04.310
we're gonna add,

00:07:04.310 --> 00:07:07.930
created at and here we're going to specify firebase.

00:07:07.930 --> 00:07:10.890
But let's imported in the first place.

00:07:10.890 --> 00:07:14.050
Let me put import fire base from firebase app,

00:07:14.050 --> 00:07:17.980
and it is going to be firebase database server value.

00:07:17.980 --> 00:07:18.780
Timestamp.

00:07:18.780 --> 00:07:19.280
All right,

00:07:19.280 --> 00:07:19.780
now,

00:07:19.780 --> 00:07:24.240
let's use this assemble message and let's put it over here.

00:07:24.240 --> 00:07:27.640
So we're going to create a new available that will name message data.

00:07:27.640 --> 00:07:28.990
Then we're gonna call,

00:07:28.990 --> 00:07:32.450
assemble message with profile and Chad I d.

00:07:32.450 --> 00:07:36.150
So we're gonna get profile from our context.

00:07:36.150 --> 00:07:43.930
So let's poor profile from use profile Hook that we have from profile context,

00:07:43.930 --> 00:07:45.190
use profile.

00:07:45.190 --> 00:07:46.050
And also,

00:07:46.050 --> 00:07:47.580
we need to get chat idee.

00:07:47.580 --> 00:07:54.550
And we can get it with the help off use Paramus that comes from react Router youth programs

00:07:54.550 --> 00:07:54.550
.

00:07:54.550 --> 00:07:55.550
All right,

00:07:55.550 --> 00:07:55.970
good.

00:07:55.970 --> 00:07:58.040
Now to this message data,

00:07:58.040 --> 00:08:01.530
we need to attach the actual message text.

00:08:01.530 --> 00:08:02.520
So here,

00:08:02.520 --> 00:08:03.750
let's pacify message.

00:08:03.750 --> 00:08:06.260
Data text is going to be our input.

00:08:06.260 --> 00:08:06.750
All right.

00:08:06.750 --> 00:08:13.150
And now the thing is that we need to perform an atomic operation to update data in multiple

00:08:13.150 --> 00:08:16.410
places inside database with real time data base.

00:08:16.410 --> 00:08:18.180
It is really easy to do,

00:08:18.180 --> 00:08:19.460
and I really love that.

00:08:19.460 --> 00:08:19.790
Wait.

00:08:19.790 --> 00:08:20.960
So what we will do?

00:08:20.960 --> 00:08:24.650
We will create a new message inside messages path.

00:08:24.650 --> 00:08:25.300
And also,

00:08:25.300 --> 00:08:27.080
we will update rooms.

00:08:27.080 --> 00:08:29.080
And here we're gonna put another prop,

00:08:29.080 --> 00:08:30.000
vegetable name,

00:08:30.000 --> 00:08:31.020
last message.

00:08:31.020 --> 00:08:35.590
This is to display last message here inside this chat room list.

00:08:35.590 --> 00:08:36.120
All right,

00:08:36.120 --> 00:08:37.820
so what we're going to do,

00:08:37.820 --> 00:08:40.070
we're going to create a new object.

00:08:40.070 --> 00:08:42.000
It will be an empty object by default,

00:08:42.000 --> 00:08:43.450
which is going to be updates.

00:08:43.450 --> 00:08:51.160
And the logic will be the next inside this object we model our update data inside database

00:08:51.160 --> 00:08:54.080
related Lee to the route off the database.

00:08:54.080 --> 00:08:58.070
So we will have the update pass as a key.

00:08:58.070 --> 00:08:59.390
And for this key,

00:08:59.390 --> 00:09:01.380
we will have the actual updated data,

00:09:01.380 --> 00:09:05.860
and then we will call this updates to the route off the database,

00:09:05.860 --> 00:09:08.840
and it will perform it as an atomic operation.

00:09:08.840 --> 00:09:09.950
I really like that way.

00:09:09.950 --> 00:09:15.960
So what I mean is that first we need to define a new message I d in advance.

00:09:15.960 --> 00:09:17.180
So for that,

00:09:17.180 --> 00:09:19.380
let's create new variable message I d.

00:09:19.380 --> 00:09:19.600
Here.

00:09:19.600 --> 00:09:21.210
We're gonna put database.

00:09:21.210 --> 00:09:26.890
This time it will be database that comes from Let me again,

00:09:26.890 --> 00:09:28.120
how to import it,

00:09:28.120 --> 00:09:28.470
right?

00:09:28.470 --> 00:09:29.450
It doesn't work.

00:09:29.450 --> 00:09:30.550
Let's do it manually.

00:09:30.550 --> 00:09:35.550
So we're gonna import database from MISC.

00:09:35.550 --> 00:09:36.330
All right,

00:09:36.330 --> 00:09:38.620
let's go back to folders.

00:09:38.620 --> 00:09:39.370
Okay,

00:09:39.370 --> 00:09:40.470
One more level.

00:09:40.470 --> 00:09:42.410
Misc firebase.

00:09:42.410 --> 00:09:43.110
All right,

00:09:43.110 --> 00:09:43.710
Perfect.

00:09:43.710 --> 00:09:43.990
So,

00:09:43.990 --> 00:09:44.730
database,

00:09:44.730 --> 00:09:48.400
then we're gonna need to specify reference to our messages.

00:09:48.400 --> 00:09:50.510
Then we're gonna floor push,

00:09:50.510 --> 00:09:56.200
and then we will get keep this way we can get and unique key from riel time database

00:09:56.200 --> 00:09:58.480
without creating the actual document.

00:09:58.480 --> 00:09:59.160
Okay,

00:09:59.160 --> 00:10:02.130
Now we need to update this updates object.

00:10:02.130 --> 00:10:07.580
So let's put updates and our first property is going to be messages.

00:10:07.580 --> 00:10:11.600
Then we're going to specify message I d over here.

00:10:11.600 --> 00:10:12.750
And for this message,

00:10:12.750 --> 00:10:13.140
I d.

00:10:13.140 --> 00:10:18.740
We're gonna pacify message data than second object is going to be rooms,

00:10:18.740 --> 00:10:25.770
slash chat I D and slash last message and for last message,

00:10:25.770 --> 00:10:30.320
we're gonna pacify all off our message data and also on top of it,

00:10:30.320 --> 00:10:32.470
we're gonna attach message i d.

00:10:32.470 --> 00:10:37.380
So message I d is going to be message I d like this.

00:10:37.380 --> 00:10:40.850
Now we need to update the actual database.

00:10:40.850 --> 00:10:41.770
So here,

00:10:41.770 --> 00:10:42.910
we're gonna put to try,

00:10:42.910 --> 00:10:43.850
catch block,

00:10:43.850 --> 00:10:49.510
and here we're going to call a wait and let's convert dysfunction Teoh a sink function.

00:10:49.510 --> 00:10:52.100
We're gonna call our database with Treff.

00:10:52.100 --> 00:10:57.580
So we get reference to the road off our database without specifying the path,

00:10:57.580 --> 00:11:02.360
Then which is gonna call update and we're gonna pass our updates object,

00:11:02.360 --> 00:11:05.790
and it will peak All update passed from Keys,

00:11:05.790 --> 00:11:11.240
and it will update these past inside the database right after our data is updated.

00:11:11.240 --> 00:11:14.880
We gonna call set input to an empty string again,

00:11:14.880 --> 00:11:20.710
and also we're gonna put alert door error and we're gonna specify ever dock message,

00:11:20.710 --> 00:11:21.180
okay?

00:11:21.180 --> 00:11:24.050
And also maybe Let's define loading state.

00:11:24.050 --> 00:11:25.850
So next to this import,

00:11:25.850 --> 00:11:29.260
let's create is loading and sad is loaning,

00:11:29.260 --> 00:11:33.040
which will be set to false by default.

00:11:33.040 --> 00:11:38.150
Then we're gonna call said is loading right before we do any asynchronous task.

00:11:38.150 --> 00:11:40.690
In case if we failed,

00:11:40.690 --> 00:11:42.990
we're gonna call it as Satya Falls.

00:11:42.990 --> 00:11:44.640
And when we are finished,

00:11:44.640 --> 00:11:45.180
also,

00:11:45.180 --> 00:11:46.600
we're gonna call False.

00:11:46.600 --> 00:11:50.870
Now let's use dis loading state for this button.

00:11:50.870 --> 00:11:56.310
So let's put disabled Onley when our data is loading right now,

00:11:56.310 --> 00:11:58.790
maybe let's save and let's take a look.

00:11:58.790 --> 00:11:59.600
What do you have?

00:11:59.600 --> 00:12:03.970
So if I send any message to the database,

00:12:03.970 --> 00:12:08.960
I have permission tonight and that's because we didn't specify any security rules.

00:12:08.960 --> 00:12:10.520
Let's navigate to rules.

00:12:10.520 --> 00:12:13.750
And then let's just copy all of that.

00:12:13.750 --> 00:12:16.020
Let's paste it here at the bottom.

00:12:16.020 --> 00:12:23.690
Let's rename it to your messages and let's specify message I d Let's save it and let's

00:12:23.690 --> 00:12:26.550
synchronize it with our local rules.

00:12:26.550 --> 00:12:30.050
And now let's try and send a new message.

00:12:30.050 --> 00:12:32.200
So if I click now,

00:12:32.200 --> 00:12:35.990
let's open our database and here I can see a new path,

00:12:35.990 --> 00:12:40.100
which is messages I have newly generated key,

00:12:40.100 --> 00:12:45.770
which is actually this message I d that we created with this line of code.

00:12:45.770 --> 00:12:47.060
If we open it here,

00:12:47.060 --> 00:12:49.730
we have created at belonging stewed This room I,

00:12:49.730 --> 00:12:51.610
d text author,

00:12:51.610 --> 00:12:54.610
is the next person and inside rooms.

00:12:54.610 --> 00:12:55.680
If we open now,

00:12:55.680 --> 00:12:58.320
we also have lost a message,

00:12:58.320 --> 00:13:01.020
which is this message that we sent.

00:13:01.020 --> 00:13:03.070
So it looks just fine.

00:13:03.070 --> 00:13:10.870
The only thing I want to do here is actually I want to maybe at a new handler for on key

00:13:10.870 --> 00:13:11.750
down event.

00:13:11.750 --> 00:13:14.220
So when we also click on Enter Button,

00:13:14.220 --> 00:13:16.220
the message is being sent.

00:13:16.220 --> 00:13:18.660
So for this import,

00:13:18.660 --> 00:13:24.950
let's also put on key down event and we're going to specify on key down handler,

00:13:24.950 --> 00:13:26.490
Let's put it next,

00:13:26.490 --> 00:13:28.240
Teoh on input change.

00:13:28.240 --> 00:13:33.270
And this on Qi down is going to be Or maybe let's put it here at the bottom,

00:13:33.270 --> 00:13:36.050
next to on sent click inside on key down.

00:13:36.050 --> 00:13:39.330
We will receive an event object this time,

00:13:39.330 --> 00:13:44.080
and we're gonna ask if event Kiko or equals 13.

00:13:44.080 --> 00:13:47.120
If our button that we press is enter,

00:13:47.120 --> 00:13:55.010
then we first gonna call event prevent default to prevent any default functionality defined

00:13:55.010 --> 00:13:56.350
for this button.

00:13:56.350 --> 00:13:59.600
Then we're going to call on sent click.

00:13:59.600 --> 00:14:00.320
All right,

00:14:00.320 --> 00:14:00.750
now,

00:14:00.750 --> 00:14:05.370
let's try one more time if I say hello again.

00:14:05.370 --> 00:14:10.900
If I click enter right message has been sent and the database has been updated.

00:14:10.900 --> 00:14:12.370
So I guess that's it.

00:14:12.370 --> 00:14:13.980
Let's finish this video.

00:14:13.980 --> 00:14:18.600
Let's commit all off our changes by calling good at everything.

00:14:18.600 --> 00:14:21.150
Then get commit and,

00:14:21.150 --> 00:14:27.360
let's specify created charred bottom Sent messages to de chat.

00:14:27.360 --> 00:14:29.230
Splendid.

00:14:29.230 --> 00:14:30.550
See you in the next one.

