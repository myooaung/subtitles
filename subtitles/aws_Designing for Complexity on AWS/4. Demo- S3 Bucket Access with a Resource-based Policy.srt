1
00:00:02,240 --> 00:00:06,310
[Autogenerated] Let's add a resource based policy to an S3 bucket that

2
00:00:06,310 --> 00:00:10,600
allows all users in a different trusted account to list the bucket

3
00:00:10,600 --> 00:00:13,940
contents and download objects in the bucket,

4
00:00:13,940 --> 00:00:18,070
will then create a policy to allow users in the trusted account

5
00:00:18,070 --> 00:00:22,040
to perform both actions and see what happens when either the

6
00:00:22,040 --> 00:00:27,130
resource based policy on the bucket or the policy over user's in

7
00:00:27,130 --> 00:00:29,940
the trusted account changes.

8
00:00:29,940 --> 00:00:34,740
I'm in the Globo app Deva account in the S3 console.

9
00:00:34,740 --> 00:00:38,630
Let's go ahead and create a bucket so we can add an object to it.

10
00:00:38,630 --> 00:00:43,120
Then we'll attach a resource based policy to the bucket that will allow

11
00:00:43,120 --> 00:00:48,940
access to users from another account will create the bucket.

12
00:00:48,940 --> 00:00:52,220
I'll call it com dot Globomantics app.

13
00:00:52,220 --> 00:00:53,340
One.

14
00:00:53,340 --> 00:00:58,340
We'll go ahead and accept the defaults and create the bucket.

15
00:00:58,340 --> 00:01:01,440
Let's add an image to the bucket.

16
00:01:01,440 --> 00:01:03,940
I'll add this green check mark image.

17
00:01:03,940 --> 00:01:04,620
Next,

18
00:01:04,620 --> 00:01:08,990
we'll need to attach a resource based policy to allow members of

19
00:01:08,990 --> 00:01:13,960
another account to list the bucket contents and download objects

20
00:01:13,960 --> 00:01:21,240
in the bucket will go to permissions, then bucket policy.

21
00:01:21,240 --> 00:01:26,410
Here is a policy that allows members of the security account to both

22
00:01:26,410 --> 00:01:32,080
list the bucket and get objects from the bucket notice under resource

23
00:01:32,080 --> 00:01:36,210
that we're restricting it to only this bucket and objects in this

24
00:01:36,210 --> 00:01:41,340
bucket will save the policy.

25
00:01:41,340 --> 00:01:45,140
And now we're ready to switch over to our other account.

26
00:01:45,140 --> 00:01:47,510
Here's our security account notice.

27
00:01:47,510 --> 00:01:52,740
The account number is the same one that we listed over in the policy.

28
00:01:52,740 --> 00:01:56,500
We're going to create a policy that allows access to that

29
00:01:56,500 --> 00:01:59,440
bucket that's been shared with this account.

30
00:01:59,440 --> 00:02:04,250
This policy will allow all actions that have been granted for this

31
00:02:04,250 --> 00:02:08,340
particular bucket and the objects in this bucket.

32
00:02:08,340 --> 00:02:11,740
We'll review the policy.

33
00:02:11,740 --> 00:02:16,140
We'll call it Access Shared Bucket and give it a description.

34
00:02:16,140 --> 00:02:16,690
Again.

35
00:02:16,690 --> 00:02:18,570
You'll want to come up with some sort of naming

36
00:02:18,570 --> 00:02:25,540
convention to organize your groups, create the policy.

37
00:02:25,540 --> 00:02:29,230
And now let's create a group that we can attach this policy to

38
00:02:29,230 --> 00:02:34,040
and add users so that they have this access.

39
00:02:34,040 --> 00:02:35,140
I'll call it Access.

40
00:02:35,140 --> 00:02:39,240
Dev's Bucket will select the policy that we just created.

41
00:02:39,240 --> 00:02:43,740
Now let's add User one to this group.

42
00:02:43,740 --> 00:02:45,630
Let's Le Guin as user one.

43
00:02:45,630 --> 00:02:49,930
To see this in action, I'm now logged in as user one.

44
00:02:49,930 --> 00:02:51,320
In the security account.

45
00:02:51,320 --> 00:02:53,140
Let's go to S3.

46
00:02:53,140 --> 00:02:56,000
You may be wondering Why are we seeing an error?

47
00:02:56,000 --> 00:02:57,700
I thought we have access to this.

48
00:02:57,700 --> 00:03:02,280
What we're seeing right here is the S3 from the security account user.

49
00:03:02,280 --> 00:03:07,190
One doesn't have any permissions to view the S3 bucket in the security account

50
00:03:07,190 --> 00:03:11,260
in order to view the S3 bucket from a different account,

51
00:03:11,260 --> 00:03:17,120
will either need to configure the CLI or use a direct URL to list

52
00:03:17,120 --> 00:03:20,620
the bucket in the other account there were interested in To access

53
00:03:20,620 --> 00:03:23,240
a bucket directly from the console.

54
00:03:23,240 --> 00:03:29,490
Simply type S3 dot console dot AWS .NET amazon dot com slash

55
00:03:29,490 --> 00:03:36,070
S3 slash buckets slash the name of the bucket in our case com

56
00:03:36,070 --> 00:03:39,640
dot Globomantics .NET app 0.0.1.

57
00:03:39,640 --> 00:03:43,580
Here we can see the image that was uploaded and download.

58
00:03:43,580 --> 00:03:48,740
The image here is user to in the same security account.

59
00:03:48,740 --> 00:03:53,040
Let's try to access that bucket directly with this user,

60
00:03:53,040 --> 00:03:57,940
since this user has not been given permissions in its own account.

61
00:03:57,940 --> 00:04:03,040
Even though the resource policy grants access to all users in this account,

62
00:04:03,040 --> 00:04:06,980
this user has not specifically been given permission by

63
00:04:06,980 --> 00:04:10,340
its own account to access the bucket.

64
00:04:10,340 --> 00:04:13,510
Suppose you changed your mind and no longer wanted to allow

65
00:04:13,510 --> 00:04:17,130
users in the other account to download objects from the

66
00:04:17,130 --> 00:04:20,240
bucket but only list buckets.

67
00:04:20,240 --> 00:04:25,520
You can modify the resource based policy on that bucket and remove

68
00:04:25,520 --> 00:04:31,740
the gett object action from objects in the bucket.

69
00:04:31,740 --> 00:04:38,040
We'll save our changes now if we go back to use er one and refresh the page.

70
00:04:38,040 --> 00:04:43,390
We can still see the item, but notice that the download button is disabled.

71
00:04:43,390 --> 00:04:46,900
This is because the resource based policy no longer

72
00:04:46,900 --> 00:04:51,740
grants a download permission.

73
00:04:51,740 --> 00:04:52,650
Great job.

74
00:04:52,650 --> 00:04:56,450
You've seen how you can organize multiple accounts in your AWS

75
00:04:56,450 --> 00:05:01,140
organization and use rolls to manage cross account access.

76
00:05:01,140 --> 00:05:04,770
You've also seen how resource based policies are different

77
00:05:04,770 --> 00:05:09,250
from rolls and where you can use resource based policies to

78
00:05:09,250 --> 00:05:11,940
allow cross account access.

79
00:05:11,940 --> 00:05:20,000
Next, we're going to cover using federation and AWS single sign on, including Amazon cognito.

