1
00:00:00,940 --> 00:00:01,390
[Autogenerated] Okay.

2
00:00:01,390 --> 00:00:04,100
Now building off of cloudwatch events.

3
00:00:04,100 --> 00:00:06,040
It leads us into cloud trail.

4
00:00:06,040 --> 00:00:11,790
Now A W s Cloud trail is the service that AWS provides that you can use to

5
00:00:11,790 --> 00:00:16,770
help ensure that you meet strict auditing guidelines and maintain a strict

6
00:00:16,770 --> 00:00:19,890
security posture within your AWS accounts.

7
00:00:19,890 --> 00:00:22,560
Now, there are three things that I want to touch on before we dive in.

8
00:00:22,560 --> 00:00:27,090
The first is the cloud trail helps enable governance compliance

9
00:00:27,090 --> 00:00:29,990
and then risk auditing of our AWS accounts.

10
00:00:29,990 --> 00:00:30,750
And with this,

11
00:00:30,750 --> 00:00:35,110
it's actually turned on by default as soon as our account is created

12
00:00:35,110 --> 00:00:37,280
and we'll take a look at this here in a minute.

13
00:00:37,280 --> 00:00:41,310
And then the last key point is that this is the key tool for

14
00:00:41,310 --> 00:00:44,800
maintaining security and operation best practices.

15
00:00:44,800 --> 00:00:48,230
So this really allows us to maintain that strict posture I was talking

16
00:00:48,230 --> 00:00:53,080
about by allowing us to identify any malicious events or maybe out of the

17
00:00:53,080 --> 00:00:56,640
norm events that occur within our AWS accounts.

18
00:00:56,640 --> 00:01:00,080
We can create a trail to trace us back to the source.

19
00:01:00,080 --> 00:01:03,830
Now, a little tip here is that any time you hear auditing,

20
00:01:03,830 --> 00:01:05,690
you should be thinking of cloud trail.

21
00:01:05,690 --> 00:01:08,120
It was designed with auditing in mind.

22
00:01:08,120 --> 00:01:09,990
So let's go ahead and check out the consul here.

23
00:01:09,990 --> 00:01:12,240
And if I go up to services,

24
00:01:12,240 --> 00:01:15,170
we can see that cloud trail actually falls underneath the

25
00:01:15,170 --> 00:01:18,170
management and governance section of the services.

26
00:01:18,170 --> 00:01:19,480
So let me load this up here,

27
00:01:19,480 --> 00:01:22,880
and you can see it brings us to this welcome to cloud Trail screen.

28
00:01:22,880 --> 00:01:23,050
Now,

29
00:01:23,050 --> 00:01:25,610
the first thing we see here is that we can create a trail

30
00:01:25,610 --> 00:01:27,130
which will do here in a little bit.

31
00:01:27,130 --> 00:01:30,090
But then the next thing below that is, we have recent events,

32
00:01:30,090 --> 00:01:33,890
and you can see these are the most recent events recorded by Cloud Trail.

33
00:01:33,890 --> 00:01:37,090
And if I scroll around through here, you're going to see that we have event time,

34
00:01:37,090 --> 00:01:41,390
the user name our event name, and then the resource is that were affected.

35
00:01:41,390 --> 00:01:45,540
So this is a trail of the most recent events that occurred within our account.

36
00:01:45,540 --> 00:01:47,300
Now, if I want to get a deeper history,

37
00:01:47,300 --> 00:01:50,410
I can go over here on the left and I can load up event history and

38
00:01:50,410 --> 00:01:52,670
you'll see the first thing they show us is Hey,

39
00:01:52,670 --> 00:01:54,180
you don't have any trails.

40
00:01:54,180 --> 00:01:56,340
And what they mean by this is we have not created

41
00:01:56,340 --> 00:01:58,940
our own trail specific to our use.

42
00:01:58,940 --> 00:02:00,910
So we'll do that here again in a minute.

43
00:02:00,910 --> 00:02:03,280
But I just want to show you this event history section.

44
00:02:03,280 --> 00:02:06,800
So if I scroll down here, you're going to see we have an event History page.

45
00:02:06,800 --> 00:02:08,220
Now, as you can tell,

46
00:02:08,220 --> 00:02:12,700
we can view the last 90 days of events and all of these events are going to

47
00:02:12,700 --> 00:02:18,490
contain the actions taken by people groups or AWS services in your account

48
00:02:18,490 --> 00:02:21,240
and that includes all read or write events.

49
00:02:21,240 --> 00:02:23,730
So if I scroll down to this tab here or this page,

50
00:02:23,730 --> 00:02:27,720
you can see there are tons of events that have been going on within my account.

51
00:02:27,720 --> 00:02:31,120
You can see the day you can see the time the user name

52
00:02:31,120 --> 00:02:32,850
the event name like we talked about.

53
00:02:32,850 --> 00:02:34,410
And if I expand one of these,

54
00:02:34,410 --> 00:02:37,000
we can see it breaks it down in pretty great detail.

55
00:02:37,000 --> 00:02:38,940
We can see our access key that was used.

56
00:02:38,940 --> 00:02:40,870
The region The event I d.

57
00:02:40,870 --> 00:02:43,040
That is a unique I d to cloud trail.

58
00:02:43,040 --> 00:02:45,770
We get the event name the event source.

59
00:02:45,770 --> 00:02:49,600
So we deleted a bucket from S three and then we have our event time.

60
00:02:49,600 --> 00:02:51,650
It was not a read only event.

61
00:02:51,650 --> 00:02:52,570
We have a request.

62
00:02:52,570 --> 00:02:57,350
I d the source i p that the request came from and then the user name that

63
00:02:57,350 --> 00:03:00,740
actually committed this event or perform this activity.

64
00:03:00,740 --> 00:03:05,440
So this gives us a very detailed breakdown of exactly who, What, and win.

65
00:03:05,440 --> 00:03:08,480
So I'm gonna close this down now and let's go back to dashboard.

66
00:03:08,480 --> 00:03:10,280
So let's create our trail.

67
00:03:10,280 --> 00:03:13,430
I'm gonna click create trail here and we'll call this plural site.

68
00:03:13,430 --> 00:03:14,180
If we wanted to,

69
00:03:14,180 --> 00:03:17,850
we could neither apply it to all regions or we could just do it toe one region.

70
00:03:17,850 --> 00:03:20,050
And you can see that by doing all regions,

71
00:03:20,050 --> 00:03:23,140
it creates the same trail in all regions and delivers

72
00:03:23,140 --> 00:03:24,940
those log files for all regions.

73
00:03:24,940 --> 00:03:26,890
Or we can just lock it down to one region.

74
00:03:26,890 --> 00:03:27,510
So I'm gonna click.

75
00:03:27,510 --> 00:03:30,520
No, because I only want a monitor North Virginia right now.

76
00:03:30,520 --> 00:03:32,790
And then I'm gonna scroll down to manage events.

77
00:03:32,790 --> 00:03:32,940
Now,

78
00:03:32,940 --> 00:03:35,910
management events is where we define what kind of

79
00:03:35,910 --> 00:03:37,880
events that we want to monitor.

80
00:03:37,880 --> 00:03:40,390
So do we want all read and write,

81
00:03:40,390 --> 00:03:43,740
or do we only want one of the other or even none now?

82
00:03:43,740 --> 00:03:45,650
Good thing to keep in mind here is that read.

83
00:03:45,650 --> 00:03:49,930
Only events are going to be like describe or get or list And then

84
00:03:49,930 --> 00:03:52,410
our rights are gonna be anything that's creating,

85
00:03:52,410 --> 00:03:56,820
updating or deleting so usual standard practices to capture all events.

86
00:03:56,820 --> 00:03:59,330
But you might have a use case where you want to just

87
00:03:59,330 --> 00:04:01,750
specify a specific event type,

88
00:04:01,750 --> 00:04:04,920
so we'll leave all for now and I'll scroll down here and you can see

89
00:04:04,920 --> 00:04:07,720
they give us another section called data Events.

90
00:04:07,720 --> 00:04:07,910
Now,

91
00:04:07,910 --> 00:04:11,740
this is where it can give us mawr insights into specific resource is that

92
00:04:11,740 --> 00:04:16,870
AWS has and you can see it's s three or lambda so we can record object

93
00:04:16,870 --> 00:04:22,100
level ap I activities like get object put objects for our buckets or within

94
00:04:22,100 --> 00:04:26,570
Lambda we can actually see all invoke a p I operations as well for all of

95
00:04:26,570 --> 00:04:28,530
our functions in this region.

96
00:04:28,530 --> 00:04:29,810
Now, I'm not gonna capturing these,

97
00:04:29,810 --> 00:04:33,400
So let me scroll down here and the next thing we see is storage location.

98
00:04:33,400 --> 00:04:38,270
So this is where we place our cloud trail trails at where do

99
00:04:38,270 --> 00:04:40,790
we want to store these audited events?

100
00:04:40,790 --> 00:04:42,900
So I'll create a new bucket here Well saw select.

101
00:04:42,900 --> 00:04:46,530
Yes, I'll go and give this name of plural site hyphen Andrew,

102
00:04:46,530 --> 00:04:47,640
just so it's not taken.

103
00:04:47,640 --> 00:04:49,020
I know that buckets not taken.

104
00:04:49,020 --> 00:04:51,050
And then if I expand advanced right here,

105
00:04:51,050 --> 00:04:53,930
we can see we can give our log files prefix.

106
00:04:53,930 --> 00:04:56,500
So if I wanted to, I could give this a prefix of demo.

107
00:04:56,500 --> 00:04:59,600
And now every log that goes in there is going to start like

108
00:04:59,600 --> 00:05:04,210
this Demo a ws logs account I d Cloud Trail,

109
00:05:04,210 --> 00:05:05,920
which is the service and then our region.

110
00:05:05,920 --> 00:05:08,510
Now we can also encrypt log files which will do so.

111
00:05:08,510 --> 00:05:11,720
Let's use service side encryption here, and I want to create a new key.

112
00:05:11,720 --> 00:05:15,450
And I'll just call this test for now because I'll go and delete it and clean

113
00:05:15,450 --> 00:05:19,150
it up after this clip and one little tidbit to notice here,

114
00:05:19,150 --> 00:05:22,860
which is pretty standard that your kms key and buckets need to be in

115
00:05:22,860 --> 00:05:26,340
the same region if you're using the existing key and the next thing

116
00:05:26,340 --> 00:05:28,770
we have is we can enable log validation.

117
00:05:28,770 --> 00:05:32,480
So this is gonna let us essentially verify and validate that our cloud

118
00:05:32,480 --> 00:05:35,970
trail logs have not been tampered with in any way.

119
00:05:35,970 --> 00:05:38,300
So you definitely want to keep this enabled if you're using

120
00:05:38,300 --> 00:05:40,690
this for auditing purposes and then lastly,

121
00:05:40,690 --> 00:05:44,980
if we wanted to weaken, send an SMS notification for every log file delivery.

122
00:05:44,980 --> 00:05:45,860
So if we want,

123
00:05:45,860 --> 00:05:49,550
we can maybe receive an email every time we get a file dumped into our bucket.

124
00:05:49,550 --> 00:05:51,520
So I'm gonna go and leave that as no.

125
00:05:51,520 --> 00:05:52,390
Now, quick refresher.

126
00:05:52,390 --> 00:05:55,410
Before we continue, we're creating a new bucket called parole site.

127
00:05:55,410 --> 00:05:58,540
Andrew, we're giving a log file prefix of demo.

128
00:05:58,540 --> 00:06:02,840
We are gonna encrypt our log files with service side encryption using kms,

129
00:06:02,840 --> 00:06:05,680
and it's gonna be a new came s key that we're creating.

130
00:06:05,680 --> 00:06:09,360
We are gonna validate our log files to make sure they're not tampered with,

131
00:06:09,360 --> 00:06:12,140
but we're not gonna alert when they actually get delivered.

132
00:06:12,140 --> 00:06:14,950
So I'm gonna scroll down here and I'm gonna click on create.

133
00:06:14,950 --> 00:06:18,440
And there we go our new plural site, Cloud Trail Trail.

134
00:06:18,440 --> 00:06:20,390
Now, this is gonna take a little bit to catch up.

135
00:06:20,390 --> 00:06:23,490
So what I'm going to do is load this up here and I'm gonna go ahead and

136
00:06:23,490 --> 00:06:27,280
start poking around my account so we can get some events flagged within

137
00:06:27,280 --> 00:06:29,460
our cloud trail trail that we just created.

138
00:06:29,460 --> 00:06:31,490
So I'm gonna pause this and we'll be right back.

139
00:06:31,490 --> 00:06:31,820
Okay,

140
00:06:31,820 --> 00:06:34,380
so I've let the cloud trail kind of sit in the background

141
00:06:34,380 --> 00:06:37,200
for a little bit while I perform some events and let's go

142
00:06:37,200 --> 00:06:38,540
and see what this is all about.

143
00:06:38,540 --> 00:06:43,190
So we've configured this cloud trail to use this bucket with our prefix,

144
00:06:43,190 --> 00:06:46,390
were encrypted and then were writing to s three.

145
00:06:46,390 --> 00:06:48,240
So let's go ahead and check that out.

146
00:06:48,240 --> 00:06:50,100
I have s three preloaded here,

147
00:06:50,100 --> 00:06:52,920
and we can see now that our cloud trail events have

148
00:06:52,920 --> 00:06:55,160
been pushed in the designated format.

149
00:06:55,160 --> 00:06:58,380
We have our bucket over here, followed by our prefix of demo.

150
00:06:58,380 --> 00:07:03,230
We have our logs account I D Cloud trail our region,

151
00:07:03,230 --> 00:07:05,950
and then what it does is it breaks it up for a date.

152
00:07:05,950 --> 00:07:09,140
So we have 2019 the month and then the day.

153
00:07:09,140 --> 00:07:12,080
And what I did here is I opened one of these cloud trail events up,

154
00:07:12,080 --> 00:07:15,270
and I want hadn't made it pretty over here in V s code.

155
00:07:15,270 --> 00:07:18,700
I just wanted you to see what it looks like from an event standpoint.

156
00:07:18,700 --> 00:07:22,680
It's essentially just a giant Jason payload that allows for

157
00:07:22,680 --> 00:07:27,090
quick scanning and references to certain key value pairs so we

158
00:07:27,090 --> 00:07:30,740
can see we have our records here, which is a standard event for AWS.

159
00:07:30,740 --> 00:07:34,340
And then within this list, you see, we have our I am user.

160
00:07:34,340 --> 00:07:37,670
There's our access key or a principle i d what user it

161
00:07:37,670 --> 00:07:40,330
was weaken CMF a was authenticated.

162
00:07:40,330 --> 00:07:42,380
So I was using MF A for this.

163
00:07:42,380 --> 00:07:45,700
And then if we scroll down here, we can see the event itself.

164
00:07:45,700 --> 00:07:48,310
We have our event time, the source,

165
00:07:48,310 --> 00:07:53,120
the event name our region R I P address which I blocked out for this and then

166
00:07:53,120 --> 00:07:56,230
you can see there's actually even some request parameters.

167
00:07:56,230 --> 00:08:00,480
So this is when we created our cloud trail earlier within this clip.

168
00:08:00,480 --> 00:08:02,730
So this captures aton of information.

169
00:08:02,730 --> 00:08:04,340
I mean, if I just scroll through this quickly,

170
00:08:04,340 --> 00:08:08,740
you can see there's line after line of trail events within this,

171
00:08:08,740 --> 00:08:11,610
so this can really get populated pretty quickly.

172
00:08:11,610 --> 00:08:13,770
So I'm gonna scroll back to the console and let's go

173
00:08:13,770 --> 00:08:15,340
back to Cloud Troll Management.

174
00:08:15,340 --> 00:08:18,720
Now the next thing I want to show you is we can actually configure cloud

175
00:08:18,720 --> 00:08:24,170
trail to push to cloudwatch logs where we can build alarming or notifications

176
00:08:24,170 --> 00:08:26,910
off of so we can push it to a law group and then,

177
00:08:26,910 --> 00:08:28,610
using that law group, weaken,

178
00:08:28,610 --> 00:08:34,910
utilize cloudwatch events in metrics to post toe on SNS notification or topic.

179
00:08:34,910 --> 00:08:38,820
I should say that gives us a notification to check everything out,

180
00:08:38,820 --> 00:08:40,520
so I'm not going to do that in this clip.

181
00:08:40,520 --> 00:08:42,210
But it's just something to keep mind.

182
00:08:42,210 --> 00:08:43,840
If you want to build alerting,

183
00:08:43,840 --> 00:08:47,970
you'll want to utilize cloudwatch logs using this log group

184
00:08:47,970 --> 00:08:51,640
functionality and one last thing before we wrap up here.

185
00:08:51,640 --> 00:08:53,990
A neat little feature for Cloud Drill is,

186
00:08:53,990 --> 00:08:55,840
if you're part of an organization,

187
00:08:55,840 --> 00:09:00,150
you can actually enable this at the top or the master account in the

188
00:09:00,150 --> 00:09:05,650
organization and create a trail for all of your sub accounts that can push

189
00:09:05,650 --> 00:09:08,560
all to essential place for you to monitor in audit.

190
00:09:08,560 --> 00:09:11,550
So that's a pretty handy way to audit all of your

191
00:09:11,550 --> 00:09:13,950
different accounts in a simplified manner.

192
00:09:13,950 --> 00:09:16,590
So we're gonna go on wrap this clip up on Cloud Trail,

193
00:09:16,590 --> 00:09:22,000
and I'll see you in the next one. We're going to start diving into Amazon, Inspector

