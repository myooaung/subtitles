WEBVTT
1
00:00:08.440 --> 00:00:11.880
[Autogenerated] So here we have our project on currently in this project,

2
00:00:11.880 --> 00:00:16.050
we don't have flyway installed, So if we look at the great URL tasks,

3
00:00:16.050 --> 00:00:18.940
we see the are in no flyway tasks there.

4
00:00:18.940 --> 00:00:22.440
So we need to install Flyway into this project to start using it.

5
00:00:22.440 --> 00:00:24.080
Now with this project structure,

6
00:00:24.080 --> 00:00:27.840
we have a root project that route projects called Jacket.

7
00:00:27.840 --> 00:00:31.140
And we have to sub projects jacket repository and jacket.

8
00:00:31.140 --> 00:00:31.920
Web and a.

9
00:00:31.920 --> 00:00:35.930
I'm going to add the flyway, plugging information into the root project.

10
00:00:35.930 --> 00:00:39.530
So the way to do that is that we need to tell grade all the name

11
00:00:39.530 --> 00:00:42.870
and the version of the plug in and a to have it a play that plug

12
00:00:42.870 --> 00:00:45.640
into the projects that need it.

13
00:00:45.640 --> 00:00:49.120
Now I'm going to add the plug in in to all projects so that later on,

14
00:00:49.120 --> 00:00:52.480
when we have many more projects than we have now in this application will

15
00:00:52.480 --> 00:00:55.840
be able to run the plug in from any of those projects.

16
00:00:55.840 --> 00:01:00.320
The plug in is named or dot flyway db flyway,

17
00:01:00.320 --> 00:01:03.140
and you can find this information on the flyway website.

18
00:01:03.140 --> 00:01:07.240
I then need to call, apply plug in for all projects.

19
00:01:07.240 --> 00:01:09.760
So once I'm done, I got a great URL.

20
00:01:09.760 --> 00:01:10.610
I do a refresh.

21
00:01:10.610 --> 00:01:15.430
All there's are reimport the greater Bill files and rebuild all the project

22
00:01:15.430 --> 00:01:20.640
information and refresh all the plug ins across those projects.

23
00:01:20.640 --> 00:01:22.910
We can now see that on the right hand side,

24
00:01:22.910 --> 00:01:29.540
we have the various flyway tasks that we can executable flyway migrate.

25
00:01:29.540 --> 00:01:30.840
So now that we have that,

26
00:01:30.840 --> 00:01:35.940
we can now add the configuration data for flyway by calling the flyway closure.

27
00:01:35.940 --> 00:01:37.990
So with the flyway plug in installed,

28
00:01:37.990 --> 00:01:41.900
we need to configure Fly away when we do that by adding a call to fly

29
00:01:41.900 --> 00:01:44.860
away on passing the parameters that flyway needs,

30
00:01:44.860 --> 00:01:49.640
such as the J D b c URL and a locations to find the migrations.

31
00:01:49.640 --> 00:01:52.890
I'm going to do this in the web project because the web project is

32
00:01:52.890 --> 00:01:56.120
currently the only real project we have through.

33
00:01:56.120 --> 00:02:00.440
Positive Project isn't being used, it's just a placeholder, and it's empty.

34
00:02:00.440 --> 00:02:02.340
So the web project is the one project that we have

35
00:02:02.340 --> 00:02:06.140
essentially so while at the Court of Flyway there.

36
00:02:06.140 --> 00:02:09.750
So if I open up the buildup cradle for jacket web and a

37
00:02:09.750 --> 00:02:13.040
called a flyway at the end of this file.

38
00:02:13.040 --> 00:02:16.130
So here we are specifying the ____ to connect to.

39
00:02:16.130 --> 00:02:17.840
We're using my SQL.

40
00:02:17.840 --> 00:02:21.610
We're specifying the username on the password on these are define is Constance.

41
00:02:21.610 --> 00:02:25.440
Elsewhere in this project, we specify the schemer.

42
00:02:25.440 --> 00:02:29.840
We have a database called Jacket __ and take up to that in a moment

43
00:02:29.840 --> 00:02:32.190
we specify the locations for these migrations.

44
00:02:32.190 --> 00:02:36.040
We don't have any migrations yet, but we'll write those in the moment.

45
00:02:36.040 --> 00:02:40.200
What we're saying here is these migration files will live in a directory.

46
00:02:40.200 --> 00:02:42.440
This relatives the root of the project.

47
00:02:42.440 --> 00:02:44.540
We'll see how to find that in a moment.

48
00:02:44.540 --> 00:02:48.740
I'm also going to special by some other flags that fly way might need.

49
00:02:48.740 --> 00:02:52.040
I don't want the names off my migration fast to have a prefix.

50
00:02:52.040 --> 00:02:57.300
So I turned that off baseline on My great says that if I have an

51
00:02:57.300 --> 00:03:00.190
existing database and a want to migration against it,

52
00:03:00.190 --> 00:03:02.570
do I allow that my sentiments are true?

53
00:03:02.570 --> 00:03:04.040
We allow that behavior.

54
00:03:04.040 --> 00:03:06.340
So if we have an existing database and running

55
00:03:06.340 --> 00:03:11.120
migration by making this flag true, that will allow flyway to say Okay,

56
00:03:11.120 --> 00:03:14.840
I understand that where we currently are in this database is the baseline.

57
00:03:14.840 --> 00:03:19.050
I should not be running migrations against out of order.

58
00:03:19.050 --> 00:03:20.500
True says,

59
00:03:20.500 --> 00:03:25.280
if you found migration one a migration three on I now find migration to.

60
00:03:25.280 --> 00:03:28.490
Should I apply that By setting this flag to true,

61
00:03:28.490 --> 00:03:31.530
I'm allowing this out of order running of migrations.

62
00:03:31.530 --> 00:03:34.040
The default value for this is falsy.

63
00:03:34.040 --> 00:03:36.610
So now that we have this we can create some migrations

64
00:03:36.610 --> 00:03:39.340
and run them against the database.

65
00:03:39.340 --> 00:03:40.300
But before we do that,

66
00:03:40.300 --> 00:03:44.740
let's just take a look at the database first to show this actually empty.

67
00:03:44.740 --> 00:03:47.240
So inside my SQL workbench we can See,

68
00:03:47.240 --> 00:03:50.770
we have a jagged devi schemer if they open up the schemer

69
00:03:50.770 --> 00:03:53.670
that are no tables or views or functions.

70
00:03:53.670 --> 00:03:54.120
So indeed,

71
00:03:54.120 --> 00:03:56.340
we currently have an empty database here that we

72
00:03:56.340 --> 00:04:00.740
can now apply the migrations to.

73
00:04:00.740 --> 00:04:02.650
So I want to add some migrations.

74
00:04:02.650 --> 00:04:06.140
And the first thing we need to do is to figure out where to add these.

75
00:04:06.140 --> 00:04:07.750
So I look at the flyway command,

76
00:04:07.750 --> 00:04:11.640
you can see it's set to create the migrations relative to the project directory.

77
00:04:11.640 --> 00:04:16.240
So one directory down and a Increased Migrations directory,

78
00:04:16.240 --> 00:04:19.740
and it turns out that actually this project directory here,

79
00:04:19.740 --> 00:04:22.480
So I do a right-click here and do new directory.

80
00:04:22.480 --> 00:04:27.640
I'll call this directory migrations we can create the migrations in there.

81
00:04:27.640 --> 00:04:30.170
Notice that especially to subdirectories here,

82
00:04:30.170 --> 00:04:33.200
common on my SQL so we can create those inside here.

83
00:04:33.200 --> 00:04:41.140
Also, once we have those we can create our first migration.

84
00:04:41.140 --> 00:04:44.220
So I want to create a migration inside the common folder.

85
00:04:44.220 --> 00:04:48.140
There'll be a SQL migration will run against any database.

86
00:04:48.140 --> 00:04:50.670
So when I create migration inside the Commons folder,

87
00:04:50.670 --> 00:04:54.130
it'll be a secret migration that can run against any database.

88
00:04:54.130 --> 00:04:54.390
And a.

89
00:04:54.390 --> 00:04:56.940
I'm going to use the SQL that we saw on the slide.

90
00:04:56.940 --> 00:05:00.810
So typically, when we create a migration, we give it a version number.

91
00:05:00.810 --> 00:05:03.970
So I call this one on then the name of the migration.

92
00:05:03.970 --> 00:05:05.400
So we'll call this one.

93
00:05:05.400 --> 00:05:07.700
Create articles table.

94
00:05:07.700 --> 00:05:13.140
It will be a dot SQL file, so one create articles table dot SQL.

95
00:05:13.140 --> 00:05:14.490
We've seen this off this already,

96
00:05:14.490 --> 00:05:17.300
so it will create the table which will have an ID which

97
00:05:17.300 --> 00:05:18.890
will be an auto increment column.

98
00:05:18.890 --> 00:05:21.350
Not what we set the primary key as well,

99
00:05:21.350 --> 00:05:26.540
and it will have a URL archived in favorite columns in that table.

100
00:05:26.540 --> 00:05:30.830
So inside idea If I go to the jacket web project and then

101
00:05:30.830 --> 00:05:33.230
find the flyway commands and find flyway,

102
00:05:33.230 --> 00:05:37.120
migrate and execute that we should see that we run flyway

103
00:05:37.120 --> 00:05:39.830
migrate and it's run without any errors.

104
00:05:39.830 --> 00:05:44.440
So hopefully we've updated the my SQL schemer.

105
00:05:44.440 --> 00:05:47.820
If I flip into my SQL and refresh the Schemer, then we'll see.

106
00:05:47.820 --> 00:05:49.170
We've actually added to tables.

107
00:05:49.170 --> 00:05:55.140
Here we have the articles table with the ID URL archived and favorite columns.

108
00:05:55.140 --> 00:05:58.540
But there's also a flyway schemer history table.

109
00:05:58.540 --> 00:06:03.500
If I do a select star from Jackie DBT schema flyway history will see the

110
00:06:03.500 --> 00:06:07.640
at this table has information about flyway migrations.

111
00:06:07.640 --> 00:06:10.040
It tells me which migrations have run.

112
00:06:10.040 --> 00:06:13.120
It tells me that we just run the create articles table

113
00:06:13.120 --> 00:06:16.840
migration against this database.

114
00:06:16.840 --> 00:06:20.180
Okay, so we can use the migration to create tables in the schema.

115
00:06:20.180 --> 00:06:24.140
How about altering that table in the schema?

116
00:06:24.140 --> 00:06:29.090
So if I had another migration, so do new file on this will be migration to.

117
00:06:29.090 --> 00:06:36.250
So to underscore on, we'll do an ad title column to articles SQL on for this one.

118
00:06:36.250 --> 00:06:40.140
We're going to alter the table so we'll alter the table articles.

119
00:06:40.140 --> 00:06:44.840
V8 Just save that And again, just run the flyway, my great command.

120
00:06:44.840 --> 00:06:48.440
Now we can go back and check the tables and do a refresh.

121
00:06:48.440 --> 00:06:49.840
If I look in the articles table.

122
00:06:49.840 --> 00:06:51.420
Now we'll have the IDE.

123
00:06:51.420 --> 00:06:57.600
You are archived favorite and a title columns inside there so we can

124
00:06:57.600 --> 00:07:00.860
apply as many of these schemes that we want to to make sure the tables

125
00:07:00.860 --> 00:07:03.740
are in a state that we need them to be in.

126
00:07:03.740 --> 00:07:06.350
But now, as you can see, you might end up with many,

127
00:07:06.350 --> 00:07:10.330
many many of these small migration files to is often a good idea.

128
00:07:10.330 --> 00:07:12.820
At some point to normalize these and a,

129
00:07:12.820 --> 00:07:17.640
bring them together into one file or maybe a few carefully crafted files.

130
00:07:17.640 --> 00:07:22.940
This will make the management of these far as much, much easier.

131
00:07:22.940 --> 00:07:25.640
So I just want to add one more thing to this table.

132
00:07:25.640 --> 00:07:29.640
I just want to add an Images column that we'll use later in this course.

133
00:07:29.640 --> 00:07:31.500
So again, same process will do.

134
00:07:31.500 --> 00:07:38.240
New file on this will be called three So ADD IMAGE column to articles table SQL.

135
00:07:38.240 --> 00:07:39.640
It's another altar.

136
00:07:39.640 --> 00:07:41.540
This time we're adding a long blob.

137
00:07:41.540 --> 00:07:45.000
This is gonna be a binary column again.

138
00:07:45.000 --> 00:07:48.870
If I save the files and execute the migration, look at the tables.

139
00:07:48.870 --> 00:07:52.140
It's now in a state where we can start using it.

140
00:07:52.140 --> 00:07:53.480
So now that we have this,

141
00:07:53.480 --> 00:07:55.930
how do we go about getting at the data inside this

142
00:07:55.930 --> 00:07:59.240
table on adding data to the table.

143
00:07:59.240 --> 00:08:06.000
To do that, we've got to use something called repositories, so let's see how we do that now.

